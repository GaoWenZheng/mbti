<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>PANASé‡è¡¨ç”µå­ç‰ˆ</title>
    <style>
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }

        .question-group {
            margin: 15px 0;
            border-bottom: 1px solid #eee;
            padding: 10px;
        }

        .options {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
        }

        .option-label {
            flex: 1;
            text-align: center;
        }

        button {
            margin: 10px;
            padding: 8px 15px;
        }

        #history {
            margin-top: 20px;
        }

        /* New styles */
        .info-section {
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .info-header {
            padding: 10px;
            background: #f5f5f5;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .info-content {
            padding: 15px;
            display: none;
        }

        .info-content.active {
            display: block;
        }

        .chart-container {
            width: 100%;
            height: 300px;
            margin: 20px 0;
        }

        .arrow {
            transition: transform 0.3s;
        }

        .arrow.active {
            transform: rotate(180deg);
        }

        .score-explanation {
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 4px;
        }

        /* æ–°å¢å†å²è®°å½•æŠ˜å é¢æ¿æ ·å¼ */
        .history-item {
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .history-header {
            padding: 10px;
            background: #f5f5f5;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
        }

        .history-details {
            padding: 15px;
            display: none;
        }

        .answer-detail {
            margin: 5px 0;
            padding: 8px;
            background: #f9f9f9;
            border-radius: 4px;
        }

        .analysis-section {
            margin-top: 15px;
            padding: 10px;
            background: #fff3e0;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2>PANASé‡è¡¨</h2>
        <div class="info-section">
            <div class="info-header" onclick="toggleInfo('instructions')">
                <span>ğŸ“ ä½¿ç”¨è¯´æ˜ï¼ˆé¦–æ¬¡ä½¿ç”¨å¿…è¯»ï¼‰</span>
                <span class="arrow">â–¼</span>
            </div>
            <div id="instructions" class="info-content">
                <div class="score-explanation">
                    <h4>ä¸€ã€å·¥å…·ç®€ä»‹</h4>
                    <p>æœ¬é‡è¡¨åŸºäºWatsonç­‰äººå¼€å‘çš„PANASï¼ˆç§¯æä¸æ¶ˆææƒ…æ„Ÿé‡è¡¨ï¼‰ï¼Œç”¨äºæµ‹é‡æ‚¨å½“å‰çš„æƒ…ç»ªçŠ¶æ€ã€‚åŒ…å«20ä¸ªæƒ…æ„Ÿè¯æ±‡ï¼Œåˆ†ä¸ºï¼š</p>
                    <ul>
                        <li>ç§¯ææƒ…æ„Ÿ(PA)ï¼š10ä¸ªé¡¹ç›®ï¼Œåæ˜ ç²¾åŠ›å……æ²›ç¨‹åº¦</li>
                        <li>æ¶ˆææƒ…æ„Ÿ(NA)ï¼š10ä¸ªé¡¹ç›®ï¼Œåæ˜ ä¸»è§‚å›°æ‰°ç¨‹åº¦</li>
                    </ul>

                    <h4>äºŒã€æ“ä½œæŒ‡å—</h4>
                    <ol>
                        <li>è¯·æ ¹æ®<strong>æ­¤æ—¶æ­¤åˆ»</strong>çš„çœŸå®æ„Ÿå—ä½œç­”</li>
                        <li>æ¯ä¸ªé¢˜ç›®ä»"éå¸¸è½»å¾®"åˆ°"æå¼º"æœ‰5ä¸ªé€‰é¡¹ï¼š
                            <div class="options" style="justify-content:start;gap:15px;margin:10px 0">
                                <span>1â†’éå¸¸è½»å¾®</span>
                                <span>3â†’ä¸­ç­‰</span>
                                <span>5â†’æå¼º</span>
                            </div>
                        </li>
                        <li>å®Œæˆæ‰€æœ‰20é¢˜åç‚¹å‡»ã€æäº¤ã€‘ç”ŸæˆæŠ¥å‘Š</li>
                        <li>å¯éšæ—¶é€šè¿‡ã€å¯¼å‡ºæ•°æ®ã€‘å¤‡ä»½è®°å½•</li>
                    </ol>

                    <h4>ä¸‰ã€æ³¨æ„äº‹é¡¹</h4>
                    <ul>
                        <li>â— æ•°æ®å­˜å‚¨åœ¨æµè§ˆå™¨æœ¬åœ°ï¼Œæ¸…ç©ºç¼“å­˜ä¼šä¸¢å¤±è®°å½•</li>
                        <li>â± å»ºè®®åœ¨å›ºå®šæ—¶é—´æ®µï¼ˆå¦‚æ¯å‘¨ä¸€ä¸Šåˆï¼‰å®šæœŸæµ‹é‡</li>
                        <li>ğŸ’¡ æŸ¥çœ‹å†å²è¶‹åŠ¿å¯ç‚¹å‡»<em>æƒ…æ„Ÿè¶‹åŠ¿åˆ†æ</em></li>
                        <li>ğŸ”„ é‡æ–°ä½œç­”å‰è¯·å…ˆæäº¤å½“å‰è®°å½•</li>
                    </ul>

                    <h4>å››ã€ç»“æœè§£è¯»</h4>
                    <div class="analysis-section">
                        <p>å…¸å‹å¾—åˆ†æ¨¡å¼ç¤ºä¾‹ï¼š</p>
                        <table border="1" style="width:100%;border-collapse:collapse;margin:10px 0">
                            <tr>
                                <th style="padding:8px">PA/NAç»„åˆ</th>
                                <th style="padding:8px">æƒ…ç»ªçŠ¶æ€</th>
                            </tr>
                            <tr>
                                <td style="padding:8px">é«˜PA + ä½NA</td>
                                <td style="padding:8px">æœ€ä½³çŠ¶æ€ï¼Œå……æ»¡æ´»åŠ›</td>
                            </tr>
                            <tr>
                                <td style="padding:8px">ä½PA + é«˜NA</td>
                                <td style="padding:8px">éœ€è¦å…³æ³¨æƒ…ç»ªå¥åº·</td>
                            </tr>
                        </table>
                        <p>è¯¦ç»†è§£é‡Šè¯·å±•å¼€<em>PA/NAè¯´æ˜</em>æŸ¥çœ‹å„åˆ†æ•°æ®µå»ºè®®</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- PA/NAè¯´æ˜éƒ¨åˆ† -->
        <div class="info-section">
            <div class="info-header" onclick="toggleInfo('pa-info')">
                <span>ç§¯ææƒ…æ„Ÿ(PA)è¯´æ˜</span>
                <span class="arrow">â–¼</span>
            </div>
            <div id="pa-info" class="info-content">
                <p>ç§¯ææƒ…æ„Ÿ(PA)åæ˜ äº†ä¸€ä¸ªäººæ„Ÿåˆ°çƒ­æƒ…ã€æ´»è·ƒå’Œè­¦è§‰çš„ç¨‹åº¦ã€‚é«˜PAè¡¨ç°ä¸ºç²¾åŠ›å……æ²›ã€å…¨ç¥è´¯æ³¨å’Œæ„‰å¿«å‚ä¸ï¼›ä½PAåˆ™è¡¨ç°ä¸ºæ‚²ä¼¤å’Œå€¦æ€ ã€‚</p>
                <div class="score-explanation">
                    <strong>åˆ†æ•°è§£é‡Šï¼š</strong><br>
                    10-20åˆ†ï¼šæä½PAæ°´å¹³<br>
                    21-30åˆ†ï¼šä½PAæ°´å¹³<br>
                    31-40åˆ†ï¼šä¸­ç­‰PAæ°´å¹³<br>
                    41-50åˆ†ï¼šé«˜PAæ°´å¹³
                </div>
            </div>
        </div>

        <div class="info-section">
            <div class="info-header" onclick="toggleInfo('na-info')">
                <span>æ¶ˆææƒ…æ„Ÿ(NA)è¯´æ˜</span>
                <span class="arrow">â–¼</span>
            </div>
            <div id="na-info" class="info-content">
                <p>æ¶ˆææƒ…æ„Ÿ(NA)åæ˜ äº†ä¸»è§‚ç—›è‹¦å’Œä¸æ„‰å¿«å‚ä¸çš„ç¨‹åº¦ã€‚é«˜NAè¡¨ç°ä¸ºæ„¤æ€’ã€è½»è”‘ã€åŒæ¶ã€å†…ç–šã€ææƒ§å’Œç´§å¼ ï¼›ä½NAåˆ™è¡¨ç°ä¸ºå¹³é™å’Œå®‰å®ã€‚</p>
                <div class="score-explanation">
                    <strong>åˆ†æ•°è§£é‡Šï¼š</strong><br>
                    10-20åˆ†ï¼šä½NAæ°´å¹³<br>
                    21-30åˆ†ï¼šä¸­ä½NAæ°´å¹³<br>
                    31-40åˆ†ï¼šä¸­é«˜NAæ°´å¹³<br>
                    41-50åˆ†ï¼šé«˜NAæ°´å¹³
                </div>
            </div>
        </div>

        <!-- è¶‹åŠ¿åˆ†æå›¾ -->
        <div class="info-section">
            <div class="info-header" onclick="toggleInfo('trend-analysis')">
                <span>æƒ…æ„Ÿè¶‹åŠ¿åˆ†æ</span>
                <span class="arrow">â–¼</span>
            </div>
            <div id="trend-analysis" class="info-content">
                <canvas id="trendChart" class="chart-container"></canvas>
                <div id="chart-explanation" class="score-explanation"></div>
            </div>
        </div>

        <div id="questionnaire"></div>
        <button onclick="submitForm()">æäº¤</button>
        <button onclick="exportData()">å¯¼å‡ºæ•°æ®</button>
        <button onclick="importData()">å¯¼å…¥æ•°æ®</button>
        <button onclick="clearHistory()">æ¸…é™¤è®°å½•</button>

        <div id="history"></div>
    </div>

    <script>
        // åŸæœ‰çš„PANASé‡è¡¨ç»“æ„ä»£ç ä¿æŒä¸å˜
        const panasItems = [
            { type: 'PA', text: 'å…´å¥‹çš„' },
            { type: 'PA', text: 'è‡ªè±ªçš„' },
            { type: 'PA', text: 'å……æ»¡çƒ­æƒ…çš„' },
            { type: 'PA', text: 'è­¦è§‰çš„' },
            { type: 'PA', text: 'åšå®šçš„' },
            { type: 'PA', text: 'å—é¼“èˆçš„' },
            { type: 'PA', text: 'ä¸“æ³¨çš„' },
            { type: 'PA', text: 'ä¸»åŠ¨çš„' },
            { type: 'PA', text: 'åšå¼ºçš„' },
            { type: 'PA', text: 'æ„Ÿå…´è¶£çš„' },
            { type: 'NA', text: 'ææƒ§çš„' },
            { type: 'NA', text: 'æ•Œæ„çš„' },
            { type: 'NA', text: 'ç¾æ„§çš„' },
            { type: 'NA', text: 'ç´§å¼ çš„' },
            { type: 'NA', text: 'æ„¤æ€’çš„' },
            { type: 'NA', text: 'å†…ç–šçš„' },
            { type: 'NA', text: 'ä¸å®‰çš„' },
            { type: 'NA', text: 'çƒ¦èºçš„' },
            { type: 'NA', text: 'å®³æ€•çš„' },
            { type: 'NA', text: 'æ‚²ä¼¤çš„' }
        ];
        // åˆå§‹åŒ–é—®å·
        function initQuestionnaire() {
            const container = document.getElementById('questionnaire');
            panasItems.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'question-group';
                div.innerHTML = `
            <div>${index + 1}. ${item.text}</div>
            <div class="options">
                <label class="option-label">
                    <input type="radio" name="q${index}" value="1"> éå¸¸è½»å¾®
                </label>
                <label class="option-label">
                    <input type="radio" name="q${index}" value="2"> è½»å¾®
                </label>
                <label class="option-label">
                    <input type="radio" name="q${index}" value="3"> ä¸­ç­‰
                </label>
                <label class="option-label">
                    <input type="radio" name="q${index}" value="4"> è¾ƒå¼º
                </label>
                <label class="option-label">
                    <input type="radio" name="q${index}" value="5"> æå¼º
                </label>
            </div>
        `;
                container.appendChild(div);
            });
        }
        // ä¿å­˜åˆ°LocalStorage
        function saveRecord(data) {
            const records = JSON.parse(localStorage.getItem('panasRecords') || '[]');
            records.push(data);
            localStorage.setItem('panasRecords', JSON.stringify(records));
            showHistory();
        }
        // åˆ‡æ¢ä¿¡æ¯æ˜¾ç¤º
        function toggleInfo(id) {
            const content = document.getElementById(id);
            const arrow = content.previousElementSibling.querySelector('.arrow');
            content.classList.toggle('active');
            arrow.classList.toggle('active');
        }

        // ç»˜åˆ¶è¶‹åŠ¿å›¾
        function drawChart() {
            const records = JSON.parse(localStorage.getItem('panasRecords') || '[]');
            if (records.length === 0) return;

            const canvas = document.getElementById('trendChart');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;

            // æ¸…ç©ºç”»å¸ƒ
            ctx.clearRect(0, 0, width, height);

            // è®¾ç½®å›¾è¡¨è¾¹è·
            const margin = 40;
            const chartWidth = width - 2 * margin;
            const chartHeight = height - 2 * margin;

            // æ‰¾å‡ºPAå’ŒNAçš„æœ€å¤§å€¼å’Œæœ€å°å€¼
            let maxScore = 50;
            let minScore = 10;

            // ç»˜åˆ¶åæ ‡è½´
            ctx.beginPath();
            ctx.moveTo(margin, margin);
            ctx.lineTo(margin, height - margin);
            ctx.lineTo(width - margin, height - margin);
            ctx.stroke();

            // ç»˜åˆ¶PAæ›²çº¿
            ctx.beginPath();
            ctx.strokeStyle = '#2196F3';
            records.forEach((record, index) => {
                const x = margin + (index * chartWidth / (records.length - 1));
                const y = height - margin - ((record.PA - minScore) * chartHeight / (maxScore - minScore));
                if (index === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();

            // ç»˜åˆ¶NAæ›²çº¿
            ctx.beginPath();
            ctx.strokeStyle = '#F44336';
            records.forEach((record, index) => {
                const x = margin + (index * chartWidth / (records.length - 1));
                const y = height - margin - ((record.NA - minScore) * chartHeight / (maxScore - minScore));
                if (index === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();

            // æ·»åŠ å›¾ä¾‹
            ctx.font = '12px Arial';
            ctx.fillStyle = '#2196F3';
            ctx.fillText('PA', width - margin - 50, margin + 20);
            ctx.fillStyle = '#F44336';
            ctx.fillText('NA', width - margin - 50, margin + 40);

            // æ›´æ–°åˆ†æè¯´æ˜
            updateChartExplanation(records);
        }
        // å¯¼å‡ºæ•°æ®ä¸ºCSV
        function exportData() {
            const records = JSON.parse(localStorage.getItem('panasRecords') || '[]');
            if (records.length === 0) {
                alert('æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®');
                return;
            }

            // åˆ›å»ºCSVå†…å®¹
            let csv = 'æ—¶é—´æˆ³,PAæ€»åˆ†,NAæ€»åˆ†,å„é¢˜ç­”æ¡ˆ\n';
            records.forEach(record => {
                csv += `${record.timestamp},${record.PA},${record.NA},"${record.answers.join(',')}"\n`;
            });

            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const blob = new Blob([csv], { type: 'text/csv' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `panas_data_${new Date().toISOString().slice(0, 10)}.csv`;
            link.click();
        }
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv';

            input.onchange = function (event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function (e) {
                    try {
                        const csvData = e.target.result;
                        const records = parseCSV(csvData);

                        if (!validateRecords(records)) {
                            alert('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·é€‰æ‹©å¯¼å‡ºçš„CSVæ–‡ä»¶');
                            return;
                        }

                        // åˆå¹¶æ•°æ®å¹¶å»é‡
                        const existingRecords = JSON.parse(localStorage.getItem('panasRecords') || '[]');
                        const newRecords = mergeRecords(existingRecords, records);

                        localStorage.setItem('panasRecords', JSON.stringify(newRecords));
                        showHistory();
                        alert(`æˆåŠŸå¯¼å…¥${records.length}æ¡è®°å½•`);
                    } catch (error) {
                        console.error(error);
                        alert('æ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // CSVè§£æå‡½æ•°
        function parseCSV(csv) {
            const rows = csv.split('\n').slice(1); // è·³è¿‡æ ‡é¢˜è¡Œ
            return rows.filter(row => row.trim()).map(row => {
                const [timestamp, PA, NA, answersStr] = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                return {
                    timestamp: timestamp.replace(/"/g, ''),
                    PA: parseInt(PA),
                    NA: parseInt(NA),
                    answers: answersStr.replace(/"/g, '').split(',').map(Number)
                };
            });
        }

        // æ•°æ®éªŒè¯å‡½æ•°
        function validateRecords(records) {
            return records.every(record =>
                record.timestamp &&
                !isNaN(record.PA) &&
                !isNaN(record.NA) &&
                Array.isArray(record.answers) &&
                record.answers.length === 20
            );
        }

        // æ•°æ®åˆå¹¶å»é‡å‡½æ•°
        function mergeRecords(existing, incoming) {
            const existingMap = new Map(existing.map(r => [r.timestamp, r]));
            incoming.forEach(r => existingMap.set(r.timestamp, r));
            return Array.from(existingMap.values()).sort((a, b) =>
                new Date(a.timestamp) - new Date(b.timestamp)
            );
        }
        // æ¸…é™¤è®°å½•
        function clearHistory() {
            if (confirm('ç¡®å®šæ¸…é™¤æ‰€æœ‰è®°å½•å—ï¼Ÿ')) {
                localStorage.removeItem('panasRecords');
                showHistory();
            }
        }
        function updateChartExplanation(records) {
            if (records.length < 2) {
                document.getElementById('chart-explanation').innerHTML = 'éœ€è¦è‡³å°‘ä¸¤æ¬¡æµ‹è¯„æ‰èƒ½è¿›è¡Œè¶‹åŠ¿åˆ†æã€‚';
                return;
            }

            const latestPA = records[records.length - 1].PA;
            const latestNA = records[records.length - 1].NA;
            const prevPA = records[records.length - 2].PA;
            const prevNA = records[records.length - 2].NA;

            let explanation = '<strong>æœ€æ–°è¶‹åŠ¿åˆ†æï¼š</strong><br>';
            explanation += `PA: ${getPATrend(latestPA, prevPA)}<br>`;
            explanation += `NA: ${getNATrend(latestNA, prevNA)}`;

            document.getElementById('chart-explanation').innerHTML = explanation;
        }

        function getPATrend(current, previous) {
            if (current > previous) return 'ç§¯ææƒ…æ„Ÿå‘ˆä¸Šå‡è¶‹åŠ¿ï¼Œè¡¨æ˜æƒ…ç»ªçŠ¶æ€æœ‰æ‰€æ”¹å–„';
            if (current < previous) return 'ç§¯ææƒ…æ„Ÿå‘ˆä¸‹é™è¶‹åŠ¿ï¼Œå¯èƒ½éœ€è¦å¤šå…³æ³¨ç§¯æä½“éªŒ';
            return 'ç§¯ææƒ…æ„Ÿä¿æŒç¨³å®š';
        }

        function getNATrend(current, previous) {
            if (current > previous) return 'æ¶ˆææƒ…æ„Ÿå‘ˆä¸Šå‡è¶‹åŠ¿ï¼Œå»ºè®®å…³æ³¨å‹åŠ›ç®¡ç†';
            if (current < previous) return 'æ¶ˆææƒ…æ„Ÿå‘ˆä¸‹é™è¶‹åŠ¿ï¼Œè¡¨æ˜è´Ÿé¢æƒ…ç»ªæœ‰æ‰€ç¼“è§£';
            return 'æ¶ˆææƒ…æ„Ÿä¿æŒç¨³å®š';
        }

        // ä¿®æ”¹æäº¤è¡¨å•å‡½æ•°
        function submitForm() {
            const answers = [];
            let paTotal = 0, naTotal = 0;

            panasItems.forEach((item, index) => {
                const selected = document.querySelector(`input[name="q${index}"]:checked`);
                if (!selected) {
                    alert('è¯·å®Œæˆæ‰€æœ‰é¢˜ç›®ï¼');
                    return;
                }
                const value = parseInt(selected.value);
                answers.push(value);

                if (item.type === 'PA') paTotal += value;
                if (item.type === 'NA') naTotal += value;
            });

            const record = {
                timestamp: new Date().toISOString(),
                answers: answers,
                PA: paTotal,
                NA: naTotal
            };

            saveRecord(record);
            // æäº¤åæ›´æ–°å›¾è¡¨
            drawChart();
        }

        function showHistory() {
            const records = JSON.parse(localStorage.getItem('panasRecords') || '[]');
            const historyDiv = document.getElementById('history');
            historyDiv.innerHTML = '<h3>å†å²è®°å½•ï¼ˆç‚¹å‡»å±•å¼€è¯¦æƒ…ï¼‰</h3>';

            records.forEach((record, index) => {
                const date = new Date(record.timestamp).toLocaleString();
                const itemDiv = document.createElement('div');
                itemDiv.className = 'history-item';
                itemDiv.innerHTML = `
                    <div class="history-header" onclick="toggleHistoryDetails(${index})">
                        <span>${date} - PA: ${record.PA} | NA: ${record.NA}</span>
                        <span class="arrow">â–¼</span>
                    </div>
                    <div id="history-detail-${index}" class="history-details" style="display: none;"></div>
                `;
                historyDiv.appendChild(itemDiv);
                populateHistoryDetails(index, record);
            });
            drawChart();
        }

        // æ–°å¢å‡½æ•°ï¼šå¡«å……å†å²è®°å½•è¯¦æƒ…
        function populateHistoryDetails(index, record) {
            const detailDiv = document.getElementById(`history-detail-${index}`);
            let detailsHtml = '<div class="analysis-section"><strong>è¯¦ç»†åˆ†æï¼š</strong>';

            // PAåˆ†æ
            detailsHtml += `<div>ç§¯ææƒ…æ„Ÿ(PA)åˆ†æï¼š${getPAScoreExplanation(record.PA)}</div>`;
            // NAåˆ†æ
            detailsHtml += `<div>æ¶ˆææƒ…æ„Ÿ(NA)åˆ†æï¼š${getNAScoreExplanation(record.NA)}</div></div>`;

            // æ˜¾ç¤ºæ¯ä¸ªé—®é¢˜çš„å›ç­”
            detailsHtml += '<div><strong>è¯¦ç»†å›ç­”ï¼š</strong>';
            panasItems.forEach((item, qIndex) => {
                const answer = record.answers[qIndex];
                const optionText = getOptionText(answer);
                detailsHtml += `
                    <div class="answer-detail">
                        ${qIndex + 1}. ${item.text} â” ${optionText} (å¾—åˆ†: ${answer})
                    </div>
                `;
            });
            detailsHtml += '</div>';

            // è¶‹åŠ¿åˆ†æï¼ˆå¦‚æœæœ‰å‰æ¬¡è®°å½•ï¼‰
            if (index > 0) {
                const prevRecord = JSON.parse(localStorage.getItem('panasRecords'))[index - 1];
                detailsHtml += `
                    <div class="analysis-section">
                        <strong>è¶‹åŠ¿å¯¹æ¯”ï¼š</strong>
                        <div>PAè¶‹åŠ¿ï¼š${getPATrend(record.PA, prevRecord.PA)}</div>
                        <div>NAè¶‹åŠ¿ï¼š${getNATrend(record.NA, prevRecord.NA)}</div>
                    </div>
                `;
            }

            detailDiv.innerHTML = detailsHtml;
        }

        // æ–°å¢è¾…åŠ©å‡½æ•°
        function toggleHistoryDetails(index) {
            const detailDiv = document.getElementById(`history-detail-${index}`);
            const arrow = detailDiv.previousElementSibling.querySelector('.arrow');
            detailDiv.style.display = detailDiv.style.display === 'none' ? 'block' : 'none';
            arrow.classList.toggle('active');
        }

        function getOptionText(value) {
            const options = {
                1: 'éå¸¸è½»å¾®',
                2: 'è½»å¾®',
                3: 'ä¸­ç­‰',
                4: 'è¾ƒå¼º',
                5: 'æå¼º'
            };
            return options[value] || 'æœªé€‰æ‹©';
        }

        function getPAScoreExplanation(score) {
            if (score <= 20) return 'æä½PAæ°´å¹³ï¼ˆå¯èƒ½è¡¨ç°ä¸ºæ‚²ä¼¤å’Œå€¦æ€ ï¼‰';
            if (score <= 30) return 'ä½PAæ°´å¹³ï¼ˆå»ºè®®å¢åŠ ç§¯ææ´»åŠ¨ï¼‰';
            if (score <= 40) return 'ä¸­ç­‰PAæ°´å¹³ï¼ˆä¿æŒè‰¯å¥½çŠ¶æ€ï¼‰';
            return 'é«˜PAæ°´å¹³ï¼ˆè¡¨ç°å‡ºè‰¯å¥½çš„ç§¯ææƒ…ç»ªï¼‰';
        }

        function getNAScoreExplanation(score) {
            if (score <= 20) return 'ä½NAæ°´å¹³ï¼ˆå¤„äºå¹³é™çŠ¶æ€ï¼‰';
            if (score <= 30) return 'ä¸­ä½NAæ°´å¹³ï¼ˆæœ‰è½»å¾®è´Ÿé¢æƒ…ç»ªï¼‰';
            if (score <= 40) return 'ä¸­é«˜NAæ°´å¹³ï¼ˆéœ€è¦å…³æ³¨æƒ…ç»ªè°ƒèŠ‚ï¼‰';
            return 'é«˜NAæ°´å¹³ï¼ˆå»ºè®®å¯»æ±‚ä¸“ä¸šæ”¯æŒï¼‰';
        }

        // ä¿®æ”¹åçš„PA/NAè¯´æ˜éƒ¨åˆ†ï¼ˆåœ¨åŸæœ‰åŸºç¡€ä¸Šå¢å¼ºï¼‰
        const enhancedPAExplanation = `
            <p>ç§¯ææƒ…æ„Ÿ(PA)åŒ…å«ä»¥ä¸‹10ä¸ªé¡¹ç›®ï¼šå…´å¥‹çš„ã€è‡ªè±ªçš„ã€å……æ»¡çƒ­æƒ…çš„ã€è­¦è§‰çš„ã€åšå®šçš„ã€å—é¼“èˆçš„ã€ä¸“æ³¨çš„ã€ä¸»åŠ¨çš„ã€åšå¼ºçš„ã€æ„Ÿå…´è¶£çš„ã€‚</p>
            <p>æ¯ä¸ªé¡¹ç›®å¾—åˆ†1-5åˆ†ï¼Œæ€»åˆ†èŒƒå›´10-50åˆ†ã€‚å»ºè®®é€šè¿‡ä»¥ä¸‹æ–¹å¼æå‡PAï¼š
            <ul>
                <li>è¿›è¡Œæœ‰æ°§è¿åŠ¨</li>
                <li>å‚ä¸ç¤¾äº¤æ´»åŠ¨</li>
                <li>è®¾å®šå¹¶å®Œæˆå°ç›®æ ‡</li>
            </ul>
            </p>
        `;

        const enhancedNAExplanation = `
            <p>æ¶ˆææƒ…æ„Ÿ(NA)åŒ…å«ä»¥ä¸‹10ä¸ªé¡¹ç›®ï¼šææƒ§çš„ã€æ•Œæ„çš„ã€ç¾æ„§çš„ã€ç´§å¼ çš„ã€æ„¤æ€’çš„ã€å†…ç–šçš„ã€ä¸å®‰çš„ã€çƒ¦èºçš„ã€å®³æ€•çš„ã€æ‚²ä¼¤çš„ã€‚</p>
            <p>æ¯ä¸ªé¡¹ç›®å¾—åˆ†1-5åˆ†ï¼Œæ€»åˆ†èŒƒå›´10-50åˆ†ã€‚å»ºè®®é€šè¿‡ä»¥ä¸‹æ–¹å¼é™ä½NAï¼š
            <ul>
                <li>ç»ƒä¹ æ­£å¿µå†¥æƒ³</li>
                <li>è¿›è¡Œæƒ…ç»ªæ—¥è®°è®°å½•</li>
                <li>å¯»æ±‚ç¤¾ä¼šæ”¯æŒ</li>
            </ul>
            </p>
        `;

        // åœ¨é¡µé¢åˆå§‹åŒ–æ—¶æ›´æ–°è¯´æ˜å†…å®¹
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('pa-info').innerHTML += enhancedPAExplanation;
            document.getElementById('na-info').innerHTML += enhancedNAExplanation;
        });

        // åˆå§‹åŒ–
        initQuestionnaire();
        showHistory();
    </script>
</body>

</html>
