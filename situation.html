<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self' 'unsafe-inline' 'unsafe-eval' child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>海龟汤内容生成器 Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --dark-bg: #1a1a1a;
            --dark-card: #2d2d2d;
            --dark-text: #e0e0e0;
        }

        body {
            font-family: 'Microsoft YaHei', -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            transition: all 0.3s ease;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #2d3561 0%, #3d2645 100%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .dark-mode .container {
            background: var(--dark-card);
            color: var(--dark-text);
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .header-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .theme-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            padding: 0;
            margin: 0;
            list-style: none;
            border-bottom: 2px solid #e9ecef;
        }

        .dark-mode .nav-tabs {
            background: #1a1a1a;
            border-bottom-color: #444;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            font-weight: 500;
        }

        .nav-tab:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .nav-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background: rgba(102, 126, 234, 0.05);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .role-selection {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .dark-mode .role-selection {
            background: #2a2a2a;
            border-bottom-color: #444;
        }

        .role-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            text-align: center;
        }

        .dark-mode .role-title {
            color: var(--dark-text);
        }

        .role-tabs {
            display: flex;
            background: #e9ecef;
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 15px;
        }

        .dark-mode .role-tabs {
            background: #1a1a1a;
        }

        .role-tab {
            flex: 1;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: 500;
            color: #666;
        }

        .dark-mode .role-tab {
            color: #aaa;
        }

        .role-tab.active {
            background: #667eea;
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .role-description {
            text-align: center;
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }

        .dark-mode .role-description {
            color: #bbb;
        }

        .form-content {
            padding: 30px 20px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .dark-mode label {
            color: var(--dark-text);
        }

        select,
        input,
        textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
        }

        .dark-mode select,
        .dark-mode input,
        .dark-mode textarea {
            background: #1a1a1a;
            border-color: #444;
            color: var(--dark-text);
        }

        select:focus,
        input:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .checkbox-section {
            margin-bottom: 25px;
        }

        .checkbox-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 12px;
            max-height: 240px;
            overflow-y: auto;
        }

        .dark-mode .checkbox-grid {
            background: #1a1a1a;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background: white;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
        }

        .dark-mode .checkbox-item {
            background: #2d2d2d;
        }

        .checkbox-item:hover {
            border-color: #667eea;
            transform: translateY(-1px);
        }

        .checkbox-item.selected {
            border-color: #667eea;
            background: #e8f4ff;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .dark-mode .checkbox-item.selected {
            background: #3a4a7a;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            height: auto;
            margin: 0 8px 0 0;
            padding: 0;
            accent-color: #667eea;
        }

        .checkbox-item label {
            margin: 0;
            cursor: pointer;
            font-weight: normal;
            font-size: 13px;
            color: #333;
        }

        .dark-mode .checkbox-item label {
            color: var(--dark-text);
        }

        .selected-display {
            margin-top: 12px;
            padding: 12px;
            background: #e8f4ff;
            border-radius: 8px;
            border: 1px solid #667eea;
            min-height: 20px;
        }

        .dark-mode .selected-display {
            background: #3a4a7a;
            border-color: #5a6a9a;
        }

        .tag {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 10px;
            margin: 2px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
        }

        .description {
            background: #f0f8ff;
            border: 1px solid #b3d9ff;
            border-radius: 8px;
            padding: 10px;
            margin-top: 8px;
            font-size: 13px;
            color: #0066cc;
            line-height: 1.4;
        }

        .dark-mode .description {
            background: #1a3a5a;
            border-color: #2a4a6a;
            color: #6ab7ff;
        }

        .clear-btn {
            background: #dc3545;
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .clear-btn:hover {
            background: #c82333;
            transform: translateY(-1px);
        }

        .generate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 18px 30px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin: 30px 0 20px 0;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .generate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .random-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8787 100%);
            color: white;
            padding: 14px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            justify-content: center;
        }

        .random-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .random-btn:active {
            transform: translateY(0);
        }

        .output {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 16px;
        }

        .dark-mode .output {
            background: #1a1a1a;
        }

        .output-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .role-indicator {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .copy-btn {
            background: #28a745;
            color: white;
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .copy-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .prompt-content {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 24px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            color: #333;
            white-space: pre-wrap;
            max-height: 600px;
            overflow-y: auto;
        }

        .dark-mode .prompt-content {
            background: #2d2d2d;
            border-color: #444;
            color: var(--dark-text);
        }

        /* 参数显示开关样式 */
        .switch-container {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f0f8ff;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #b3d9ff;
        }

        .dark-mode .switch-container {
            background: #1a3a5a;
            border-color: #2a4a6a;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: #667eea;
        }

        input:checked+.slider:before {
            transform: translateX(26px);
        }

        .switch-label {
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }

        .dark-mode .switch-label {
            color: var(--dark-text);
        }

        /* 高级设置面板 */
        .advanced-panel {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }

        .dark-mode .advanced-panel {
            background: #1a1a1a;
            border-color: #444;
        }

        .advanced-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            user-select: none;
        }

        .advanced-header h3 {
            color: #333;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dark-mode .advanced-header h3 {
            color: var(--dark-text);
        }

        .advanced-content {
            margin-top: 20px;
            display: none;
        }

        .advanced-content.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 历史记录面板 */
        .history-panel {
            padding: 20px;
        }

        .history-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .dark-mode .history-item {
            background: #2d2d2d;
            border-color: #444;
        }

        .history-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .history-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .dark-mode .history-title {
            color: var(--dark-text);
        }

        .history-date {
            font-size: 12px;
            color: #666;
        }

        .dark-mode .history-date {
            color: #aaa;
        }

        .history-actions {
            display: flex;
            gap: 10px;
        }

        .history-action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
            color: #666;
        }

        .dark-mode .history-action-btn {
            color: #aaa;
        }

        .history-action-btn:hover {
            color: #667eea;
            transform: scale(1.2);
        }

        .history-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .history-tag {
            background: #e9ecef;
            color: #666;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
        }

        .dark-mode .history-tag {
            background: #444;
            color: #bbb;
        }

        /* 模板库面板 */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .template-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .dark-mode .template-card {
            background: #2d2d2d;
            border-color: #444;
        }

        .template-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.1);
        }

        .template-card.selected {
            border-color: #667eea;
            background: #f0f7ff;
        }

        .dark-mode .template-card.selected {
            background: #3a4a7a;
        }

        .template-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .template-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .dark-mode .template-name {
            color: var(--dark-text);
        }

        .template-desc {
            font-size: 13px;
            color: #666;
            line-height: 1.4;
        }

        .dark-mode .template-desc {
            color: #aaa;
        }

        .template-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #ffc107;
            color: #856404;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        /* 统计面板 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .stat-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .dark-mode .stat-card {
            background: #2d2d2d;
            border-color: #444;
        }

        .stat-icon {
            font-size: 32px;
            margin-bottom: 10px;
            color: #667eea;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .dark-mode .stat-value {
            color: var(--dark-text);
        }

        .stat-label {
            font-size: 14px;
            color: #666;
        }

        .dark-mode .stat-label {
            color: #aaa;
        }

        /* 参数推荐提示 */
        .recommendation-tip {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 10px 15px;
            margin-top: 10px;
            font-size: 13px;
            color: #856404;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dark-mode .recommendation-tip {
            background: #3a3a1a;
            border-color: #5a5a2a;
            color: #ffea7a;
        }

        .conflict-warning {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .dark-mode .conflict-warning {
            background: #4a1a1a;
            border-color: #6a2a2a;
            color: #ff8a8a;
        }

        /* 导出格式选择 */
        .export-options {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .export-btn {
            background: #6c757d;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .export-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        /* 批量生成模式 */
        .batch-controls {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .dark-mode .batch-controls {
            background: #1a1a1a;
        }

        .batch-count {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .batch-count input {
            width: 80px;
        }

        .batch-results {
            display: grid;
            gap: 20px;
        }

        .batch-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
        }

        .dark-mode .batch-item {
            background: #2d2d2d;
            border-color: #444;
        }

        /* 快捷键提示 */
        .shortcuts-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1001;
        }

        .dark-mode .shortcuts-modal {
            background: #2d2d2d;
        }

        .shortcuts-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .shortcut-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .dark-mode .shortcut-item {
            border-bottom-color: #444;
        }

        .shortcut-key {
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 14px;
        }

        .dark-mode .shortcut-key {
            background: #444;
        }

        /* 加载动画 */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* 评分系统 */
        .rating-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .rating-stars {
            display: flex;
            gap: 5px;
        }

        .rating-star {
            font-size: 20px;
            color: #ddd;
            cursor: pointer;
            transition: all 0.3s;
        }

        .rating-star:hover,
        .rating-star.active {
            color: #ffc107;
            transform: scale(1.2);
        }

        .rating-score {
            font-size: 14px;
            color: #666;
        }

        .dark-mode .rating-score {
            color: #aaa;
        }

        /* 进度指示器 */
        .progress-indicator {
            background: #e9ecef;
            border-radius: 8px;
            height: 8px;
            margin: 20px 0;
            overflow: hidden;
        }

        .dark-mode .progress-indicator {
            background: #444;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        /* 浮动操作按钮 */
        .fab-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column-reverse;
            gap: 15px;
            z-index: 999;
        }

        .fab {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .fab.secondary {
            width: 48px;
            height: 48px;
            font-size: 20px;
            background: #6c757d;
        }

        /* 提示工具 */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .tooltip:hover::after {
            opacity: 1;
        }

        /* 移动端适配 */
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }

            .header {
                padding: 20px 15px;
            }

            .header h1 {
                font-size: 24px;
            }

            .header-controls {
                position: static;
                margin-top: 15px;
                justify-content: center;
            }

            .form-content {
                padding: 20px 15px;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                margin-bottom: 20px;
            }

            .form-group {
                margin-bottom: 20px;
            }

            .checkbox-grid {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 6px;
                padding: 12px;
                max-height: 200px;
            }

            .checkbox-item {
                padding: 6px 8px;
                font-size: 12px;
            }

            .role-tabs {
                flex-direction: column;
                gap: 4px;
            }

            .role-tab {
                padding: 10px 16px;
                font-size: 14px;
            }

            .generate-btn {
                padding: 16px 24px;
                font-size: 16px;
            }

            .output {
                margin-top: 20px;
                padding: 15px;
            }

            .prompt-content {
                padding: 16px;
                font-size: 13px;
                max-height: 400px;
            }

            .nav-tabs {
                overflow-x: auto;
                white-space: nowrap;
                -webkit-overflow-scrolling: touch;
            }

            .nav-tab {
                flex: 0 0 auto;
                padding: 12px 16px;
                font-size: 14px;
            }

            .template-grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .fab-container {
                bottom: 20px;
                right: 20px;
            }
        }

        @media (max-width: 480px) {
            .checkbox-grid {
                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            }

            .checkbox-item {
                font-size: 11px;
                padding: 4px 6px;
            }

            .tag {
                font-size: 11px;
                padding: 3px 8px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>🐢 海龟汤内容生成器 Pro</h1>
            <p>专业级海龟汤创作工具，生成高质量逻辑严密的推理谜题</p>
            <div class="header-controls">
                <button class="theme-toggle" onclick="toggleTheme()">
                    <span id="theme-icon">🌙</span>
                </button>
                <button class="theme-toggle tooltip" data-tooltip="快捷键帮助 (Ctrl+/)" onclick="showShortcuts()">
                    ⌨️
                </button>
            </div>
        </div>

        <ul class="nav-tabs">
            <li class="nav-tab active" onclick="switchTab('generator')">🎯 生成器</li>
            <li class="nav-tab" onclick="switchTab('history')">📜 历史记录</li>
            <li class="nav-tab" onclick="switchTab('templates')">📚 模板库</li>
            <li class="nav-tab" onclick="switchTab('batch')">🔄 批量生成</li>
            <li class="nav-tab" onclick="switchTab('stats')">📊 统计分析</li>
        </ul>

        <!-- 生成器标签页 -->
        <div id="generator-tab" class="tab-content active">
            <div class="role-selection">
                <div class="role-title">选择你的角色</div>
                <div class="role-tabs">
                    <div class="role-tab active" data-role="player">
                        <div>🧩 我是玩家</div>
                    </div>
                    <div class="role-tab" data-role="host">
                        <div>🎪 我是主持人</div>
                    </div>
                </div>
                <div class="role-description" id="role-description">
                    我想要挑战海龟汤谜题，只需要汤面内容进行推理
                </div>
            </div>

            <div class="form-content">
                <form id="promptForm">
                    <!-- 随机模式按钮 -->
                    <button type="button" class="random-btn" onclick="randomizeForm()">
                        🎲 随机生成参数
                    </button>

                    <!-- 参数显示开关 -->
                    <div class="switch-container">
                        <label class="switch">
                            <input type="checkbox" id="explainParams" checked="">
                            <span class="slider"></span>
                        </label>
                        <span class="switch-label">在提示词中解释参数含义（让AI更好理解创作要求）</span>
                    </div>

                    <!-- 高级设置面板 -->
                    <div class="advanced-panel">
                        <div class="advanced-header" onclick="toggleAdvanced()">
                            <h3><span id="advanced-icon">▶</span> 高级设置</h3>
                        </div>
                        <div id="advanced-content" class="advanced-content">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="clue-density">线索密度</label>
                                    <select id="clue-density" onchange="showDescription('clue-density')">
                                        <option value="sparse">稀疏（需要深度挖掘）</option>
                                        <option value="moderate" selected="">适中（分布合理）</option>
                                        <option value="dense">密集（信息量大）</option>
                                    </select>
                                    <div id="clue-density-desc" class="description hidden"></div>
                                </div>
                                <div class="form-group">
                                    <label for="reasoning-path">推理路径</label>
                                    <select id="reasoning-path" onchange="showDescription('reasoning-path')">
                                        <option value="linear" selected="">线性（步步推进）</option>
                                        <option value="branching">分支（多条路径）</option>
                                        <option value="circular">循环（相互印证）</option>
                                    </select>
                                    <div id="reasoning-path-desc" class="description hidden"></div>
                                </div>
                                <div class="form-group">
                                    <label for="solution-uniqueness">答案唯一性</label>
                                    <select id="solution-uniqueness" onchange="showDescription('solution-uniqueness')">
                                        <option value="unique" selected="">唯一答案</option>
                                        <option value="multiple">多种解释</option>
                                        <option value="open">开放结局</option>
                                    </select>
                                    <div id="solution-uniqueness-desc" class="description hidden"></div>
                                </div>
                                <div class="form-group">
                                    <label for="red-herring">误导强度</label>
                                    <select id="red-herring" onchange="showDescription('red-herring')">
                                        <option value="none">无误导</option>
                                        <option value="mild" selected="">轻度误导</option>
                                        <option value="strong">强烈误导</option>
                                    </select>
                                    <div id="red-herring-desc" class="description hidden"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="type">谜题类型</label>
                            <select id="type" required="" onchange="showDescription('type'); checkCompatibility()">
                                <option value="">请选择类型</option>
                                <option value="经典推理">经典推理</option>
                                <option value="心理悬疑">心理悬疑</option>
                                <option value="科幻奇幻">科幻奇幻</option>
                                <option value="日常生活">日常生活</option>
                                <option value="历史人文">历史人文</option>
                                <option value="恐怖惊悚">恐怖惊悚</option>
                                <option value="爱情情感">爱情情感</option>
                                <option value="职场商业">职场商业</option>
                                <option value="家庭伦理">家庭伦理</option>
                                <option value="青春校园">青春校园</option>
                                <option value="武侠江湖">武侠江湖</option>
                                <option value="都市奇谭">都市奇谭</option>
                            </select>
                            <div id="type-desc" class="description hidden"></div>
                            <div id="type-recommend" class="recommendation-tip hidden">
                                💡 推荐搭配：<span id="type-recommend-text"></span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="difficulty">难度等级</label>
                            <select id="difficulty" required=""
                                onchange="showDescription('difficulty'); updateDifficultyRecommend()">
                                <option value="">请选择难度</option>
                                <option value="新手村">新手村</option>
                                <option value="入门级">入门级</option>
                                <option value="进阶级">进阶级</option>
                                <option value="高手级">高手级</option>
                                <option value="大师级">大师级</option>
                                <option value="传说级">传说级</option>
                                <option value="地狱级">地狱级</option>
                            </select>
                            <div id="difficulty-desc" class="description hidden"></div>
                            <div class="progress-indicator">
                                <div id="difficulty-progress" class="progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="setting">故事背景</label>
                            <select id="setting" required="" onchange="showDescription('setting')">
                                <option value="">请选择背景</option>
                                <option value="现代都市">现代都市</option>
                                <option value="古代历史">古代历史</option>
                                <option value="未来科幻">未来科幻</option>
                                <option value="乡村田园">乡村田园</option>
                                <option value="海岛孤岛">海岛孤岛</option>
                                <option value="医院学校">医院学校</option>
                                <option value="密室封闭">密室封闭</option>
                                <option value="野外探险">野外探险</option>
                                <option value="豪宅别墅">豪宅别墅</option>
                                <option value="地下世界">地下世界</option>
                                <option value="虚拟网络">虚拟网络</option>
                                <option value="异次元空间">异次元空间</option>
                            </select>
                            <div id="setting-desc" class="description hidden"></div>
                        </div>

                        <div class="form-group">
                            <label for="characters">人物设定</label>
                            <select id="characters" required="" onchange="showDescription('characters')">
                                <option value="">请选择人物</option>
                                <option value="单一主角">单一主角</option>
                                <option value="双人关系">双人关系</option>
                                <option value="家庭成员">家庭成员</option>
                                <option value="同事朋友">同事朋友</option>
                                <option value="陌生人群">陌生人群</option>
                                <option value="专业人士">专业人士</option>
                                <option value="特殊身份">特殊身份</option>
                                <option value="师生关系">师生关系</option>
                                <option value="上下级">上下级</option>
                                <option value="邻里关系">邻里关系</option>
                                <option value="网友关系">网友关系</option>
                            </select>
                            <div id="characters-desc" class="description hidden"></div>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="twist">反转类型</label>
                            <select id="twist" required="" onchange="showDescription('twist')">
                                <option value="">请选择反转</option>
                                <option value="身份反转">身份反转</option>
                                <option value="时间反转">时间反转</option>
                                <option value="空间反转">空间反转</option>
                                <option value="动机反转">动机反转</option>
                                <option value="因果反转">因果反转</option>
                                <option value="认知反转">认知反转</option>
                                <option value="双重反转">双重反转</option>
                                <option value="记忆反转">记忆反转</option>
                                <option value="生死反转">生死反转</option>
                                <option value="真假反转">真假反转</option>
                                <option value="梦境反转">梦境反转</option>
                            </select>
                            <div id="twist-desc" class="description hidden"></div>
                        </div>

                        <div class="form-group">
                            <label for="style">叙述风格</label>
                            <select id="style" required="" onchange="showDescription('style')">
                                <option value="">请选择风格</option>
                                <option value="简洁明快">简洁明快</option>
                                <option value="细腻描述">细腻描述</option>
                                <option value="悬疑紧张">悬疑紧张</option>
                                <option value="幽默诙谐">幽默诙谐</option>
                                <option value="诗意抒情">诗意抒情</option>
                                <option value="冷峻客观">冷峻客观</option>
                                <option value="温馨治愈">温馨治愈</option>
                                <option value="黑色幽默">黑色幽默</option>
                                <option value="古典优雅">古典优雅</option>
                            </select>
                            <div id="style-desc" class="description hidden"></div>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="audience">目标受众</label>
                            <select id="audience" required=""
                                onchange="showDescription('audience'); checkCompatibility()">
                                <option value="">请选择受众</option>
                                <option value="儿童友好">儿童友好（6-12岁）</option>
                                <option value="青少年">青少年（13-18岁）</option>
                                <option value="年轻成人">年轻成人（19-30岁）</option>
                                <option value="职场人士">职场人士（25-40岁）</option>
                                <option value="中年群体">中年群体（35-55岁）</option>
                                <option value="银发一族">银发一族（55岁以上）</option>
                                <option value="全年龄向">全年龄向</option>
                                <option value="专业玩家">专业玩家</option>
                                <option value="文艺青年">文艺青年</option>
                                <option value="逻辑控">逻辑控</option>
                            </select>
                            <div id="audience-desc" class="description hidden"></div>
                            <div id="audience-warning" class="conflict-warning hidden">
                                ⚠️ <span id="audience-warning-text"></span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="length">故事长度</label>
                            <select id="length" required="" onchange="showDescription('length')">
                                <option value="">请选择长度</option>
                                <option value="微型">微型（100字内）</option>
                                <option value="短篇">短篇（100-300字）</option>
                                <option value="中篇">中篇（300-600字）</option>
                                <option value="长篇">长篇（600-1000字）</option>
                                <option value="史诗">史诗（1000字以上）</option>
                            </select>
                            <div id="length-desc" class="description hidden"></div>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="logic-level">逻辑严密度</label>
                            <select id="logic-level" onchange="showDescription('logic-level')">
                                <option value="standard">标准</option>
                                <option value="strict">严格</option>
                                <option value="hardcore">极致严谨</option>
                            </select>
                            <div id="logic-level-desc" class="description hidden"></div>
                        </div>

                        <div class="form-group">
                            <label for="creativity">创意程度</label>
                            <select id="creativity" onchange="showDescription('creativity')">
                                <option value="conservative">保守经典</option>
                                <option value="balanced">平衡创新</option>
                                <option value="innovative">大胆创新</option>
                            </select>
                            <div id="creativity-desc" class="description hidden"></div>
                        </div>
                    </div>

                    <div class="checkbox-section">
                        <div class="checkbox-header">
                            <label>核心主题（多选）</label>
                            <button type="button" class="clear-btn" onclick="clearAllSelections('themes')">清空</button>
                        </div>
                        <div class="checkbox-grid" id="themes-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-friendship" value="友情"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-friendship">友情</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-love" value="爱情"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-love">爱情</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-family" value="亲情"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-family">亲情</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-betrayal" value="背叛"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-betrayal">背叛</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-redemption" value="救赎"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-redemption">救赎</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-growth" value="成长"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-growth">成长</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-choice" value="选择"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-choice">选择</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-sacrifice" value="牺牲"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-sacrifice">牺牲</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-truth" value="真相"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-truth">真相</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-justice" value="正义"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-justice">正义</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-freedom" value="自由"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-freedom">自由</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-responsibility" value="责任"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-responsibility">责任</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-forgiveness" value="宽恕"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-forgiveness">宽恕</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-hope" value="希望"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-hope">希望</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-revenge" value="复仇"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-revenge">复仇</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-memory" value="记忆"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-memory">记忆</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-time" value="时间"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-time">时间</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-death" value="生死"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-death">生死</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-identity" value="身份"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-identity">身份</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-dream" value="梦想"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-dream">梦想</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-loneliness" value="孤独"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-loneliness">孤独</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-courage" value="勇气"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-courage">勇气</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-secret" value="秘密"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-secret">秘密</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="theme-fate" value="命运"
                                    onchange="updateSelection('themes', this)">
                                <label for="theme-fate">命运</label>
                            </div>
                        </div>
                        <div class="selected-display" id="themes-display">
                            <span style="color: #666;">请选择1-3个核心主题</span>
                        </div>
                    </div>

                    <div class="checkbox-section">
                        <div class="checkbox-header">
                            <label>情节元素（可选）</label>
                            <button type="button" class="clear-btn" onclick="clearAllSelections('elements')">清空</button>
                        </div>
                        <div class="checkbox-grid" id="elements-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="element-letter" value="信件"
                                    onchange="updateSelection('elements', this)">
                                <label for="element-letter">信件</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="element-photo" value="照片"
                                    onchange="updateSelection('elements', this)">
                                <label for="element-photo">照片</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="element-key" value="钥匙"
                                    onchange="updateSelection('elements', this)">
                                <label for="element-key">钥匙</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="element-phone" value="电话"
                                    onchange="updateSelection('elements', this)">
                                <label for="element-phone">电话</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="element-mirror" value="镜子"
                                    onchange="updateSelection('elements', this)">
                                <label for="element-mirror">镜子</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="element-window" value="窗户"
                                    onchange="updateSelection('elements', this)">
                                <label for="element-window">窗户</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="element-clock" value="钟表"
                                    onchange="updateSelection('elements', this)">
                                <label for="element-clock">钟表</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="element-book" value="书籍"
                                    onchange="updateSelection('elements', this)">
                                <label for="element-book">书籍</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="element-music" value="音乐"
                                    onchange="updateSelection('elements', this)">
                                <label for="element-music">音乐</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="element-flower" value="花朵"
                                    onchange="updateSelection('elements', this)">
                                <label for="element-flower">花朵</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="element-weather" value="天气"
                                    onchange="updateSelection('elements', this)">
                                <label for="element-weather">天气</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="element-food" value="食物"
                                    onchange="updateSelection('elements', this)">
                                <label for="element-food">食物</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="element-animal" value="动物"
                                    onchange="updateSelection('elements', this)">
                                <label for="element-animal">动物</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="element-car" value="车辆"
                                    onchange="updateSelection('elements', this)">
                                <label for="element-car">车辆</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="element-money" value="金钱"
                                    onchange="updateSelection('elements', this)">
                                <label for="element-money">金钱</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="element-jewelry" value="首饰"
                                    onchange="updateSelection('elements', this)">
                                <label for="element-jewelry">首饰</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="element-medicine" value="药品"
                                    onchange="updateSelection('elements', this)">
                                <label for="element-medicine">药品</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="element-document" value="文件"
                                    onchange="updateSelection('elements', this)">
                                <label for="element-document">文件</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="element-tool" value="工具"
                                    onchange="updateSelection('elements', this)">
                                <label for="element-tool">工具</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="element-light" value="光线"
                                    onchange="updateSelection('elements', this)">
                                <label for="element-light">光线</label>
                            </div>
                        </div>
                        <div class="selected-display" id="elements-display">
                            <span style="color: #666;">可选择0-5个情节元素</span>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label for="custom-elements">自定义元素</label>
                            <input type="text" id="custom-elements" placeholder="自定义关键元素，用逗号分隔">
                        </div>

                        <div class="form-group">
                            <label for="emotion">情感基调</label>
                            <select id="emotion" onchange="showDescription('emotion')">
                                <option value="">请选择基调</option>
                                <option value="温馨感人">温馨感人</option>
                                <option value="紧张刺激">紧张刺激</option>
                                <option value="悲伤沉重">悲伤沉重</option>
                                <option value="轻松愉快">轻松愉快</option>
                                <option value="神秘诡异">神秘诡异</option>
                                <option value="励志向上">励志向上</option>
                                <option value="浪漫唯美">浪漫唯美</option>
                                <option value="深沉思辨">深沉思辨</option>
                            </select>
                            <div id="emotion-desc" class="description hidden"></div>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label for="special">特殊要求</label>
                        <textarea id="special" placeholder="例如：需要包含教育意义、避免暴力内容、融入科学知识、体现传统文化、必须有反转、不能有悲剧结局等"></textarea>
                    </div>

                    <button type="submit" class="generate-btn" id="generateBtn">
                        <span id="generate-text">🧩 生成汤面挑战</span>
                        <span id="generate-loading" class="loading-spinner hidden"></span>
                    </button>
                </form>
            </div>

            <div id="output" class="output hidden">
                <div class="output-header">
                    <div class="role-indicator" id="role-badge">玩家模式</div>
                    <button class="copy-btn" onclick="copyContent()">📋 复制内容</button>
                </div>
                <div class="prompt-content" id="prompt-content"></div>

                <!-- 评分系统 -->
                <div class="rating-container">
                    <span>为这个生成结果评分：</span>
                    <div class="rating-stars">
                        <span class="rating-star" onclick="rateGeneration(1)">★</span>
                        <span class="rating-star" onclick="rateGeneration(2)">★</span>
                        <span class="rating-star" onclick="rateGeneration(3)">★</span>
                        <span class="rating-star" onclick="rateGeneration(4)">★</span>
                        <span class="rating-star" onclick="rateGeneration(5)">★</span>
                    </div>
                    <span class="rating-score">未评分</span>
                </div>

                <!-- 导出选项 -->
                <div class="export-options">
                    <button class="export-btn" onclick="exportAs('txt')">导出为 TXT</button>
                    <button class="export-btn" onclick="exportAs('json')">导出为 JSON</button>
                </div>
            </div>
        </div>

        <!-- 历史记录标签页 -->
        <div id="history-tab" class="tab-content">
            <div class="history-panel">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #333;">生成历史</h3>
                    <div>
                        <button class="export-btn" onclick="exportHistory()">导出历史</button>
                        <button class="clear-btn" onclick="clearHistory()">清空历史</button>
                    </div>
                </div>
                <div id="history-list">
                    <!-- 历史记录项将动态插入这里 -->
                </div>
            </div>
        </div>

        <!-- 模板库标签页 -->
        <div id="templates-tab" class="tab-content">
            <div class="template-grid" id="template-grid">
                <!-- 模板卡片将动态插入这里 -->
            </div>
        </div>

        <!-- 批量生成标签页 -->
        <div id="batch-tab" class="tab-content">
            <div class="form-content">
                <div class="batch-controls">
                    <div class="batch-count">
                        <label for="batch-size">批量生成数量：</label>
                        <input type="number" id="batch-size" min="2" max="10" value="3">
                        <button class="generate-btn" style="width: auto; margin: 0;" onclick="batchGenerate()">
                            批量生成
                        </button>
                    </div>
                    <p style="color: #666; font-size: 14px; margin-top: 10px;">
                        每次生成将使用不同的随机参数组合
                    </p>
                </div>
                <div id="batch-results" class="batch-results">
                    <!-- 批量结果将显示在这里 -->
                </div>
            </div>
        </div>

        <!-- 统计分析标签页 -->
        <div id="stats-tab" class="tab-content">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">📊</div>
                    <div class="stat-value" id="total-generations">0</div>
                    <div class="stat-label">总生成次数</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">⭐</div>
                    <div class="stat-value" id="avg-rating">0.0</div>
                    <div class="stat-label">平均评分</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">🔥</div>
                    <div class="stat-value" id="favorite-type">-</div>
                    <div class="stat-label">最常用类型</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">🎯</div>
                    <div class="stat-value" id="favorite-difficulty">-</div>
                    <div class="stat-label">最常用难度</div>
                </div>
            </div>
            <div style="padding: 20px;">
                <h3 style="margin-bottom: 20px; color: #333;">使用趋势</h3>
                <canvas id="stats-chart" width="400" height="200"></canvas>
            </div>
        </div>
    </div>

    <!-- 浮动操作按钮 -->
    <div class="fab-container">
        <button class="fab secondary tooltip" data-tooltip="回到顶部" onclick="scrollToTop()">
            ↑
        </button>
        <button class="fab tooltip" data-tooltip="快速生成" onclick="quickGenerate()">
            ⚡
        </button>
    </div>

    <!-- 快捷键帮助弹窗 -->
    <div id="shortcuts-overlay" class="shortcuts-overlay hidden" onclick="hideShortcuts()"></div>
    <div id="shortcuts-modal" class="shortcuts-modal hidden">
        <h3 style="margin-bottom: 20px;">快捷键帮助</h3>
        <div class="shortcut-item">
            <span>随机生成参数</span>
            <span class="shortcut-key">Ctrl + R</span>
        </div>
        <div class="shortcut-item">
            <span>快速生成</span>
            <span class="shortcut-key">Ctrl + Enter</span>
        </div>
        <div class="shortcut-item">
            <span>复制内容</span>
            <span class="shortcut-key">Ctrl + C</span>
        </div>
        <div class="shortcut-item">
            <span>切换主题</span>
            <span class="shortcut-key">Ctrl + D</span>
        </div>
        <div class="shortcut-item">
            <span>显示帮助</span>
            <span class="shortcut-key">Ctrl + /</span>
        </div>
    </div>

    <script>
        // 这里开始是JavaScript代码部分

        // 基础数据和配置
        const descriptions = {
            type: {
                '经典推理': {
                    display: '逻辑推理为核心',
                    criteria: '核心要素：严密的逻辑链条、充分的证据支撑、清晰的因果关系。故事结构：设置谜题→提供线索→逻辑推导→真相揭示。创作要点：每个细节都应有逻辑依据，避免超自然解释，答案必须可通过推理得出。'
                },
                '心理悬疑': {
                    display: '探索内心世界',
                    criteria: '核心要素：人物心理状态、潜意识动机、情感创伤、心理防御机制。故事重点：内心独白、行为异常的心理根源、情感转折点。创作要点：深入刻画人物心理层次，展现心理变化过程，动机比行为更重要。'
                },
                '科幻奇幻': {
                    display: '超现实元素',
                    criteria: '核心要素：科技设定、超自然能力、异世界规则、时空概念。创作规则：建立自洽的世界观，超现实元素需有内在逻辑，科幻需有理论支撑。注意事项：避免用超能力简单解决问题，保持推理的核心地位。'
                },
                '日常生活': {
                    display: '平凡中的不凡',
                    criteria: '核心要素：日常场景（家庭、职场、社区）、生活细节、人情世故、常识推理。故事特点：看似平常的事件隐藏不寻常真相。创作要点：贴近生活经验，利用日常细节设置线索，答案符合生活逻辑。'
                },
                '历史人文': {
                    display: '历史文化背景',
                    criteria: '核心要素：历史事件、时代特征、文化习俗、社会制度。创作要求：尊重历史事实，符合时代逻辑，避免现代思维代入。故事价值：通过推理展现历史洞察，融入人文思考。'
                },
                '恐怖惊悚': {
                    display: '营造紧张氛围',
                    criteria: '核心要素：紧张氛围、未知恐惧、心理压迫、悬念设置。创作技巧：逐步升级恐惧感，利用未知制造恐惧，重推理轻血腥。注意尺度：避免过度恐怖描写，保持推理游戏本质。'
                },
                '爱情情感': {
                    display: '情感关系核心',
                    criteria: '核心要素：爱情发展、情感纠葛、关系转折、内心挣扎。故事焦点：情感动机驱动事件，关系变化影响真相。创作要点：细腻描写情感细节，展现情感的复杂性和真实性。'
                },
                '职场商业': {
                    display: '职场环境背景',
                    criteria: '核心要素：职场政治、利益冲突、商业竞争、职业道德。故事特征：权力斗争、商业阴谋、职场潜规则。创作要点：体现职场复杂性，展现专业领域特点，保持真实感。'
                },
                '家庭伦理': {
                    display: '家庭关系焦点',
                    criteria: '核心要素：血缘关系、家庭责任、代际冲突、道德困境。故事深度：探讨家庭内部矛盾，展现伦理两难。创作要点：处理敏感话题需谨慎，注重情感真实性，引发道德思考。'
                },
                '青春校园': {
                    display: '校园成长故事',
                    criteria: '核心要素：学生生活、成长烦恼、友情爱情、校园文化。故事特色：青春期心理、同辈压力、身份认同。创作要点：贴近学生真实体验，避免成人视角说教，保持青春活力。'
                },
                '武侠江湖': {
                    display: '古风武侠世界',
                    criteria: '核心要素：武功设定、江湖规则、侠义精神、恩怨情仇。世界观：建立完整的武侠体系，保持古风韵味。创作要点：平衡武打与推理，注重侠义精神内核，符合武侠逻辑。'
                },
                '都市奇谭': {
                    display: '都市超自然',
                    criteria: '核心要素：现代都市背景、超自然事件、都市传说、隐藏世界。创作平衡：保持都市现实感同时融入奇幻元素。故事特点：日常与超常的碰撞，现代人遭遇离奇事件。'
                }
            },
            difficulty: {
                '新手村': {
                    display: '极简入门体验',
                    criteria: '线索设置：1-2条直接明显的线索，无需推理即可发现。推理步骤：1步直接推理，如"看到A就是B"。答案特征：显而易见，符合直觉。示例："地上有水→某人刚洗完澡"。'
                },
                '入门级': {
                    display: '基础推理训练',
                    criteria: '线索设置：2-3条明显线索，需要简单组合。推理步骤：2步推理，包含一个简单因果。误导程度：最多1个易识破的误导。示例："A不在场+B有动机→B是凶手"。'
                },
                '进阶级': {
                    display: '标准推理挑战',
                    criteria: '线索设置：3-4条线索，部分需要细心发现。推理步骤：3-4步，包含1个关键转折点。误导程度：1-2个中等误导，需要分辨。示例："时间矛盾+动机分析+不在场证明→真凶另有其人"。'
                },
                '高手级': {
                    display: '复杂逻辑考验',
                    criteria: '线索设置：4-5条线索，部分隐晦需深挖。推理步骤：4-5步，含2个思维转折。误导程度：2-3个强误导，包含精心设计的假线索。示例："多重身份+时间错位+心理分析→真相完全反转"。'
                },
                '大师级': {
                    display: '高阶思维游戏',
                    criteria: '线索设置：5-6条线索，多数需要深度解读和联想。推理步骤：5-6步，包含多重反转和非线性思维。误导程度：3-4个强误导，真假难辨。示例："表象完全是假象，需要重构整个故事框架"。'
                },
                '传说级': {
                    display: '极限推理挑战',
                    criteria: '线索设置：6条以上碎片化线索，需要拼接重组。推理步骤：6步以上，需要跳跃性和创造性思维。误导程度：整体框架都可能是误导。示例："需要元认知，从推理游戏本身的角度思考"。'
                },
                '地狱级': {
                    display: '思维极限测试',
                    criteria: '线索设置：所有信息都是双重含义。推理步骤：需要哲学性、颠覆性思维。误导程度：答案可能违反所有常识和直觉。示例："真相在逻辑之外，需要跳出推理框架本身"。'
                }
            },
            setting: {
                '现代都市': {
                    display: '繁华城市环境',
                    criteria: '环境特征：高楼大厦、便利交通、发达通讯、监控系统。可用元素：手机定位、网络痕迹、都市压力、快节奏生活。创作要点：充分利用现代科技元素，体现都市人际关系复杂性。'
                },
                '古代历史': {
                    display: '历史时期背景',
                    criteria: '时代限制：无现代科技、等级制度森严、特定文化习俗。可用元素：历史事件、古代刑侦手段、社会阶层冲突。创作要点：避免现代思维，遵循历史逻辑，展现时代特色。'
                },
                '未来科幻': {
                    display: '高科技环境',
                    criteria: '科技设定：AI、全息投影、基因技术、太空旅行。创作空间：可以创造新科技，但需内在逻辑自洽。注意事项：科技是工具而非答案，保持推理的核心地位。'
                },
                '乡村田园': {
                    display: '宁静农村环境',
                    criteria: '环境特点：熟人社会、自然环境、传统习俗、慢节奏。故事元素：邻里关系、农事活动、乡土人情。创作要点：展现乡村特有的人际网络和地方特色。'
                },
                '海岛孤岛': {
                    display: '封闭岛屿环境',
                    criteria: '环境限制：与外界隔绝、人员有限、资源受限。故事优势：嫌疑人范围明确、逃脱困难、心理压力大。创作要点：充分利用封闭环境制造紧张感。'
                },
                '医院学校': {
                    display: '专业机构环境',
                    criteria: '机构特点：专业规则、等级制度、特定人群、专业设施。可用元素：专业知识、内部规则、特殊关系。创作要点：合理运用专业背景，避免过度专业化。'
                },
                '密室封闭': {
                    display: '封闭空间推理',
                    criteria: '空间特征：出入口有限、空间布局清晰、物理限制明确。推理重点：不在场证明、密室诡计、空间利用。创作要点：详细描述空间结构，物理规则必须严密。'
                },
                '野外探险': {
                    display: '自然环境故事',
                    criteria: '环境要素：天气变化、地形限制、野生动植物、生存挑战。故事特色：与自然对抗、资源争夺、方向迷失。创作要点：自然规律作为推理依据。'
                },
                '豪宅别墅': {
                    display: '富豪阶层环境',
                    criteria: '环境特征：奢华装潢、复杂格局、私密空间、安保系统。故事元素：财产纠纷、家族秘密、阶级差异。创作要点：利用空间复杂性和财富引发的冲突。'
                },
                '地下世界': {
                    display: '隐秘地下设施',
                    criteria: '环境特点：隐秘性强、规则特殊、信息封闭、危险性高。故事可能：地下组织、秘密实验、黑暗交易。创作要点：营造神秘危险氛围，规则可以特殊但需自洽。'
                },
                '虚拟网络': {
                    display: '网络空间故事',
                    criteria: '数字特征：虚拟身份、数据痕迹、网络规则、虚实交错。故事元素：网络犯罪、虚拟关系、数字证据。创作要点：展现虚拟世界特性，保持技术可信度。'
                },
                '异次元空间': {
                    display: '超现实空间',
                    criteria: '空间特性：物理法则可变、时空扭曲、维度交错。创作自由：可以打破常规，但需建立新规则体系。注意事项：保持内在逻辑一致性，避免随意设定。'
                }
            },
            length: {
                '微型': {
                    display: '极简风格',
                    criteria: '字数范围：50-100字。写作要求：每字珠玑，信息密度极高，删除所有冗余。适用场景：快速游戏、即时推理。技巧：用最少的字传达最关键的信息。'
                },
                '短篇': {
                    display: '简洁明了',
                    criteria: '字数范围：100-300字。写作要求：保留核心信息，简化次要细节，保持故事完整性。适用场景：标准快速局。技巧：平衡简洁与信息量。'
                },
                '中篇': {
                    display: '平衡篇幅',
                    criteria: '字数范围：300-600字。写作要求：适度展开细节，人物形象立体，线索分布合理。适用场景：标准游戏时长。技巧：控制节奏，主次分明。'
                },
                '长篇': {
                    display: '丰富细节',
                    criteria: '字数范围：600-1000字。写作要求：充分展开故事，深入刻画人物，细节丰富。适用场景：深度推理体验。技巧：保持紧凑，避免注水。'
                },
                '史诗': {
                    display: '极致详细',
                    criteria: '字数范围：1000字以上。写作要求：全方位展现故事世界，多线索交织，信息量巨大。适用场景：沉浸式长时间游戏。技巧：结构清晰，避免混乱。'
                }
            },
            emotion: {
                '温馨感人': {
                    display: '温暖人心基调',
                    criteria: '情感基调：温暖、感动、希望、美好。故事元素：亲情友情、互助关爱、美好结局。创作技巧：细腻描写情感细节，突出人性光辉，传递正能量。避免：过度煽情。'
                },
                '紧张刺激': {
                    display: '快节奏悬念',
                    criteria: '情感基调：紧张、刺激、悬疑、急迫。节奏控制：快速推进、悬念迭起、时间压力。创作技巧：短句营造节奏感，设置倒计时元素。保持：持续的紧张感。'
                },
                '悲伤沉重': {
                    display: '深沉情感表达',
                    criteria: '情感基调：悲伤、遗憾、失去、沉重。故事主题：生死离别、错过遗憾、牺牲奉献。创作技巧：深入挖掘情感深度，引发共鸣思考。注意：把握尺度。'
                },
                '轻松愉快': {
                    display: '轻松娱乐氛围',
                    criteria: '情感基调：轻松、愉悦、幽默、休闲。故事特点：趣味性强、压力小、结局圆满。创作技巧：加入幽默元素，保持轻快节奏。避免：沉重话题。'
                },
                '神秘诡异': {
                    display: '营造神秘氛围',
                    criteria: '情感基调：神秘、诡异、未知、困惑。氛围营造：信息模糊、暗示丰富、留白充分。创作技巧：保持适度神秘感，逐步揭示真相。平衡：神秘与可解。'
                },
                '励志向上': {
                    display: '积极正面价值',
                    criteria: '情感基调：励志、奋斗、成长、突破。故事主题：克服困难、实现梦想、自我超越。创作技巧：展现奋斗过程，突出正面价值。传递：积极人生态度。'
                },
                '浪漫唯美': {
                    display: '诗意浪漫色彩',
                    criteria: '情感基调：浪漫、唯美、诗意、梦幻。表现手法：优美语言、意境营造、情感细腻。创作技巧：注重氛围渲染，使用诗意表达。保持：美感不失真实。'
                },
                '深沉思辨': {
                    display: '哲学性思考',
                    criteria: '情感基调：深沉、理性、哲学、思辨。探讨主题：人生意义、道德困境、存在价值。创作技巧：设置思考空间，不给标准答案。引发：深层次思考。'
                }
            },
            characters: {
                '单一主角': {
                    display: '聚焦核心人物',
                    criteria: '人物设置：1个核心人物，其他为背景。叙事焦点：主角的心理、动机、行为。优势：深度刻画，减少干扰。创作要点：全方位展现主角复杂性。'
                },
                '双人关系': {
                    display: '二人互动关系',
                    criteria: '人物设置：2个主要人物的互动。关系类型：对立、合作、爱恨交织。叙事重点：关系动态变化。创作要点：平衡两人戏份，展现关系张力。'
                },
                '家庭成员': {
                    display: '家庭关系网络',
                    criteria: '人物构成：3-5个家庭成员。关系特点：血缘纽带、情感复杂、利益纠葛。故事焦点：家庭内部矛盾。创作要点：展现家庭关系的复杂性。'
                },
                '同事朋友': {
                    display: '平等关系群体',
                    criteria: '人物设置：3-6个平等地位的人。关系特征：合作竞争并存、友情与利益冲突。故事重点：群体动态。创作要点：个性鲜明，关系明确。'
                },
                '陌生人群': {
                    display: '互不相识群体',
                    criteria: '人物特点：5-8个陌生人因故聚集。关系发展：从陌生到熟悉、信任危机。故事优势：增加不确定性。创作要点：交代聚集原因。'
                },
                '专业人士': {
                    display: '特定专业背景',
                    criteria: '人物设定：2-4个特定专业人士。专业特征：专业知识、职业操守、行业规则。故事特色：专业视角。创作要点：专业性与可理解性平衡。'
                },
                '特殊身份': {
                    display: '特殊社会地位',
                    criteria: '人物类型：名人、罪犯、特工、超能力者等。身份特点：社会地位特殊、能力非凡。故事看点：身份带来的冲突。创作要点：身份设定合理。'
                },
                '师生关系': {
                    display: '教育环境关系',
                    criteria: '人物构成：1-2个老师，3-5个学生。关系特征：知识传授、成长引导、代沟存在。故事主题：教育与成长。创作要点：体现教育意义。'
                },
                '上下级': {
                    display: '职场等级关系',
                    criteria: '人物设置：2-3个层级的人物。权力关系：命令服从、利益冲突、晋升竞争。故事冲突：权力斗争。创作要点：展现职场复杂性。'
                },
                '邻里关系': {
                    display: '社区生活关系',
                    criteria: '人物范围：3-6个邻居。关系特点：表面和谐、暗流涌动、八卦传播。故事特色：生活化冲突。创作要点：贴近生活，真实可信。'
                },
                '网友关系': {
                    display: '虚拟世界交往',
                    criteria: '人物特征：2-5个网络认识的人。关系特点：身份可能虚假、距离产生美、网络痕迹。故事悬念：虚实难辨。创作要点：展现网络特性。'
                }
            },
            twist: {
                '身份反转': {
                    display: '真假身份颠覆',
                    criteria: '反转核心：人物真实身份与表面完全不同。常见形式：卧底身份、冒名顶替、一人多角。反转效果：重新理解所有前文行为。创作要点：身份线索需要精心埋设。'
                },
                '时间反转': {
                    display: '时序误导颠倒',
                    criteria: '反转核心：事件发生的时间顺序被误导。表现形式：倒叙误导、时间循环、记忆错乱。反转效果：重构整个时间线。创作要点：时间线索要严密且可验证。'
                },
                '空间反转': {
                    display: '地点空间误导',
                    criteria: '反转核心：事件发生地点或空间关系被误导。常见手法：镜像空间、虚假场景、空间错觉。反转效果：空间认知被颠覆。创作要点：空间描述需精确且有迷惑性。'
                },
                '动机反转': {
                    display: '善恶动机颠倒',
                    criteria: '反转核心：行为的真实动机与表面相反。反转类型：善意被误解、恶行是保护、牺牲被误读。反转效果：道德判断被颠覆。创作要点：动机要合理且令人信服。'
                },
                '因果反转': {
                    display: '原因结果颠倒',
                    criteria: '反转核心：因果关系被颠倒或误导。表现形式：结果是原因、原因是结果、因果链断裂。反转效果：逻辑重构。创作要点：因果链要能双向解释。'
                },
                '认知反转': {
                    display: '常识认知打破',
                    criteria: '反转核心：挑战读者的认知定式和常识。反转方式：打破思维定式、颠覆常规认知、元认知突破。反转效果：思维框架被打破。创作要点：要有说服力的新框架。'
                },
                '双重反转': {
                    display: '多层真相递进',
                    criteria: '反转核心：包含两次以上的重大反转。结构设计：初次反转→深层反转→终极真相。反转效果：层层剥茧，不断颠覆。创作要点：每层反转都要独立成立。'
                },
                '记忆反转': {
                    display: '记忆真假交错',
                    criteria: '反转核心：记忆的真实性被质疑。表现形式：虚假记忆、记忆篡改、选择性遗忘。反转效果：过去被重新定义。创作要点：记忆线索的可靠性需要标记。'
                },
                '生死反转': {
                    display: '生死状态误判',
                    criteria: '反转核心：角色的生死状态被误判。常见形式：假死脱身、死而复生、生死错位。反转效果：情感和逻辑双重冲击。创作要点：生死证据需要合理解释。'
                },
                '真假反转': {
                    display: '虚实真假颠倒',
                    criteria: '反转核心：真实与虚假的界限被打破。表现方式：谎言是真相、真相是假象、虚实交织。反转效果：真实性被质疑。创作要点：真假标准要明确。'
                },
                '梦境反转': {
                    display: '现实梦境模糊',
                    criteria: '反转核心：现实与梦境/幻觉的界限模糊。反转形式：一切都是梦、梦中梦、现实如梦。反转效果：存在性被质疑。创作要点：需要梦境标志和逻辑。'
                }
            },
            style: {
                '简洁明快': {
                    display: '直击要点风格',
                    criteria: '语言特点：短句为主、节奏明快、直接了当。适用效果：信息传递效率高、推理节奏紧凑。写作技巧：删除修饰词、使用主动语态、一句一个信息点。避免：冗长描述。'
                },
                '细腻描述': {
                    display: '丰富细节刻画',
                    criteria: '语言特点：细节丰富、描写细腻、画面感强。适用效果：沉浸感强、人物立体、场景生动。写作技巧：五感描写、心理刻画、环境渲染。平衡：细节与节奏。'
                },
                '悬疑紧张': {
                    display: '营造紧张悬念',
                    criteria: '语言特点：留白适度、节奏多变、悬念设置。技巧运用：断句制造紧张、省略号暗示、反问增强悬疑。效果追求：读者心跳加速。保持：持续的紧张感。'
                },
                '幽默诙谐': {
                    display: '轻松幽默语调',
                    criteria: '语言特点：俏皮话、双关语、轻松比喻。幽默类型：情境幽默、语言游戏、反差萌。创作平衡：幽默不失推理严肃性。避免：不合时宜的玩笑。'
                },
                '诗意抒情': {
                    display: '文学诗意表达',
                    criteria: '语言特点：修辞丰富、意境深远、韵律优美。表现手法：比喻拟人、通感联觉、意象营造。适用场景：情感表达、氛围营造。注意：不过度影响推理。'
                },
                '冷峻客观': {
                    display: '理性客观叙述',
                    criteria: '语言特点：客观陈述、零度情感、精确表达。叙述视角：第三人称客观视角、纯事实描述。适用效果：增强可信度、突出理性。避免：主观评价。'
                },
                '温馨治愈': {
                    display: '温暖治愈表达',
                    criteria: '语言特点：温柔词汇、正面描述、希望基调。情感传递：关怀、理解、支持、鼓励。创作目标：给人安慰和力量。保持：真诚不造作。'
                },
                '黑色幽默': {
                    display: '讽刺幽默手法',
                    criteria: '语言特点：反讽手法、荒诞对比、冷面笑匠。表现方式：严肃话题轻松说、悲剧喜剧化。创作难度：把握尺度和品味。适合：成熟读者。'
                },
                '古典优雅': {
                    display: '文雅古典韵味',
                    criteria: '语言特点：用词考究、句式工整、古风韵味。文学特征：引经据典、对仗工整、意蕴深厚。创作要求：文学素养、避免生硬。保持：雅俗共赏。'
                }
            },
            audience: {
                '儿童友好': {
                    display: '6-12岁儿童',
                    criteria: '内容要求：无暴力血腥、无恐怖元素、积极向上。语言特点：简单易懂、生动有趣、想象力丰富。教育价值：培养逻辑思维、传递正确价值观。禁忌内容：成人话题、负面情绪。'
                },
                '青少年': {
                    display: '13-18岁青少年',
                    criteria: '内容特点：可有适度悬疑、青春期话题、成长主题。认知水平：抽象思维发展、开始理解复杂情感。价值引导：正面但不说教、贴近生活体验。避免：过度成人化内容。'
                },
                '年轻成人': {
                    display: '19-30岁成年人',
                    criteria: '内容深度：可涉及复杂社会话题、爱情职场主题。思维特点：逻辑思维成熟、接受多元价值观。故事偏好：节奏快、贴近生活、有深度。不限制：成人话题但需适度。'
                },
                '职场人士': {
                    display: '25-40岁职场人',
                    criteria: '内容关注：职场政治、人际关系、事业发展。时间特点：碎片化时间、快速获得乐趣。故事共鸣：工作压力、生活平衡、成就追求。设计考虑：可随时暂停继续。'
                },
                '中年群体': {
                    display: '35-55岁中年人',
                    criteria: '生活阅历：丰富经验、理解复杂人性。内容偏好：家庭责任、人生感悟、社会思考。情感需求：情感共鸣、人生启发。避免：过于天真或极端的设定。'
                },
                '银发一族': {
                    display: '55岁以上老年人',
                    criteria: '内容特色：怀旧元素、人生智慧、温情故事。节奏要求：不宜太快、留有思考时间。价值观念：传统价值、家庭和睦。字体考虑：可能需要较大字体。'
                },
                '全年龄向': {
                    display: '老少皆宜',
                    criteria: '内容标准：各年龄段都能理解和欣赏。题材选择：普世价值、生活化场景。难度设置：基础难度、可选深度。语言要求：通俗易懂但不幼稚。'
                },
                '专业玩家': {
                    display: '推理游戏高手',
                    criteria: '挑战需求：高难度逻辑、复杂推理、创新玩法。内容深度：可以很烧脑、多重反转、元推理。期待要素：公平较量、严密逻辑。不需要：新手引导。'
                },
                '文艺青年': {
                    display: '文学艺术爱好者',
                    criteria: '审美追求：文学性、艺术性、思想性。内容偏好：隐喻象征、哲学思辨、诗意表达。表现形式：可以抽象、重意境。价值：精神层面的满足。'
                },
                '逻辑控': {
                    display: '纯理性推理者',
                    criteria: '核心需求：纯粹逻辑推理、排除情感干扰。评判标准：逻辑严密性、推理公平性。厌恶元素：感情用事、逻辑漏洞。追求：完美的逻辑闭环。'
                }
            },
            'logic-level': {
                'standard': {
                    display: '基本逻辑合理',
                    criteria: '逻辑标准：符合日常逻辑、不违背基本常识、因果关系合理。容错程度：允许小瑕疵、重在娱乐性。适用场景：休闲娱乐、大众化推理。平衡点：趣味性优先于严密性。'
                },
                'strict': {
                    display: '逻辑严密无瑕',
                    criteria: '逻辑要求：每个推论都有依据、证据链完整、排除其他可能。审查标准：经得起反复推敲、没有逻辑漏洞。适用人群：认真的推理爱好者。创作难度：需要仔细验证。'
                },
                'hardcore': {
                    display: '极致逻辑严谨',
                    criteria: '逻辑极限：数学般的严密性、哲学级的严谨性。论证要求：形式逻辑完美、排中律应用。可能涉及：专业逻辑学知识。适合：逻辑狂热者。'
                }
            },
            creativity: {
                'conservative': {
                    display: '经典传统模式',
                    criteria: '创作原则：遵循经典海龟汤模式、使用常见推理套路。故事结构：问题-线索-推理-答案的标准流程。优势：易于理解、规则明确。适合：新手和传统爱好者。'
                },
                'balanced': {
                    display: '传统创新平衡',
                    criteria: '创新程度：在经典基础上适度创新、加入新鲜元素。创新方向：叙事技巧、推理机制、题材融合。保持原则：核心玩法不变。目标：熟悉又新鲜的体验。'
                },
                'innovative': {
                    display: '大胆创新尝试',
                    criteria: '创新理念：打破传统框架、尝试全新机制。可能包含：非线性叙事、多维度推理、实验性玩法。风险提示：可能难以理解或接受。适合：寻求突破的玩家。'
                }
            },
            'clue-density': {
                'sparse': {
                    display: '线索稀疏',
                    criteria: '线索特征：数量少（2-3个）、分布稀疏、需要深挖。推理要求：每个线索都关键、需要充分解读、重质不重量。适合玩家：喜欢深度思考、不喜欢信息轰炸。难度来源：线索的深度而非数量。'
                },
                'moderate': {
                    display: '线索适中',
                    criteria: '线索特征：数量适中（4-6个）、分布均匀、难易结合。设计原则：关键线索+辅助线索+适量干扰。游戏体验：不会太难也不会太简单。适合：大多数玩家。'
                },
                'dense': {
                    display: '线索密集',
                    criteria: '线索特征：数量多（7个以上）、信息量大、需要筛选。能力要求：信息处理、归纳整理、抗干扰。设计包含：真假线索混杂、多条推理路径。适合：喜欢分析大量信息的玩家。'
                }
            },
            'reasoning-path': {
                'linear': {
                    display: '线性推理',
                    criteria: '路径特征：A→B→C→答案的单一路径。推理特点：步步为营、顺序清晰、结论唯一。优势：易于理解和验证。适合：新手和喜欢确定性的玩家。'
                },
                'branching': {
                    display: '分支推理',
                    criteria: '路径特征：多条可能的推理路径、不同线索组合。推理特点：需要选择和判断、可能有死胡同。游戏性：增加探索性和重玩价值。适合：喜欢探索的玩家。'
                },
                'circular': {
                    display: '循环推理',
                    criteria: '路径特征：线索相互印证、形成推理闭环。推理要求：综合思考、全局视角、线索交叉验证。复杂度：需要同时处理多个线索关系。适合：喜欢复杂推理的高手。'
                }
            },
            'solution-uniqueness': {
                'unique': {
                    display: '唯一答案',
                    criteria: '答案特征：只有一个正确答案、其他解释都有漏洞。设计要求：逻辑严密、排除歧义、证据确凿。游戏体验：明确的成就感。适合：追求确定性的传统玩家。'
                },
                'multiple': {
                    display: '多种解释',
                    criteria: '答案特征：存在2-3种合理解释、各有支撑证据。设计理念：现实的复杂性、视角的多样性。讨论价值：引发玩家讨论和思辨。适合：开放性思维的玩家。'
                },
                'open': {
                    display: '开放结局',
                    criteria: '答案特征：没有标准答案、重在推理过程。设计目的：引发思考、鼓励创造性解读。评判标准：推理的合理性而非答案本身。适合：哲学思辨型玩家。'
                }
            },
            'red-herring': {
                'none': {
                    display: '无误导',
                    criteria: '设计原则：所有信息都有用、没有误导性线索。信息特点：干净纯粹、直接相关。游戏体验：专注于逻辑推理。适合：新手或不喜欢被误导的玩家。'
                },
                'mild': {
                    display: '轻度误导',
                    criteria: '误导程度：1-2个弱误导、容易识别和排除。设计目的：增加适度挑战、不影响主线推理。识别方法：与其他线索矛盾、逻辑不自洽。平衡：挑战性与公平性。'
                },
                'strong': {
                    display: '强烈误导',
                    criteria: '误导程度：3个以上强误导、精心设计的陷阱。挑战性：可能将玩家引向完全错误的方向。设计技巧：表面合理但深究有问题。适合：经验丰富、喜欢挑战的玩家。'
                }
            }
        };
        // 全局状态管理
        let selectedData = {
            themes: [],
            elements: []
        };
        let selectedRole = 'player';
        let currentTab = 'generator';
        let generationHistory = JSON.parse(localStorage.getItem('turtleSoupHistory') || '[]');
        let statistics = JSON.parse(localStorage.getItem('turtleSoupStats') || '{}');
        let isDarkMode = localStorage.getItem('darkMode') === 'true';

        // 初始化
        document.addEventListener('DOMContentLoaded', function () {
            initializeApp();
            setupKeyboardShortcuts();
            loadHistory();
            loadTemplates();
            updateStatistics();
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                document.getElementById('theme-icon').textContent = '☀️';
            }
        });

        function initializeApp() {
            // 加载用户偏好
            loadUserPreferences();
        }

        // 主题切换
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode');
            document.getElementById('theme-icon').textContent = isDarkMode ? '☀️' : '🌙';
            localStorage.setItem('darkMode', isDarkMode);
        }

        // 标签页切换
        function switchTab(tabName) {
            currentTab = tabName;

            // 更新标签样式
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // 切换内容
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab`).classList.add('active');

            // 特定标签页的初始化
            if (tabName === 'stats') {
                drawStatsChart();
            }
        }

        // 高级设置面板
        function toggleAdvanced() {
            const content = document.getElementById('advanced-content');
            const icon = document.getElementById('advanced-icon');

            if (content.classList.contains('show')) {
                content.classList.remove('show');
                icon.textContent = '▶';
            } else {
                content.classList.add('show');
                icon.textContent = '▼';
            }
        }

        // 参数兼容性检查
        function checkCompatibility() {
            const type = document.getElementById('type').value;
            const audience = document.getElementById('audience').value;
            const warningDiv = document.getElementById('audience-warning');
            const warningText = document.getElementById('audience-warning-text');

            // 检查不兼容的组合
            if (type === '恐怖惊悚' && audience === '儿童友好') {
                warningText.textContent = '恐怖惊悚类型不适合儿童受众，建议更换类型或受众';
                warningDiv.classList.remove('hidden');
            } else if (type === '职场商业' && (audience === '儿童友好' || audience === '青少年')) {
                warningText.textContent = '职场商业类型可能不适合低龄受众';
                warningDiv.classList.remove('hidden');
            } else {
                warningDiv.classList.add('hidden');
            }

            // 显示推荐
            showRecommendations();
        }

        // 显示参数推荐
        function showRecommendations() {
            const type = document.getElementById('type').value;
            const recommendDiv = document.getElementById('type-recommend');
            const recommendText = document.getElementById('type-recommend-text');

            const recommendations = {
                '经典推理': '密室封闭背景 + 身份反转 + 逻辑严密',
                '心理悬疑': '单一主角 + 记忆反转 + 深沉思辨基调',
                '科幻奇幻': '未来科幻背景 + 时间反转 + 大胆创新',
                '日常生活': '现代都市背景 + 动机反转 + 温馨感人基调',
                '恐怖惊悚': '地下世界背景 + 生死反转 + 紧张刺激基调',
                '爱情情感': '双人关系 + 真假反转 + 浪漫唯美基调',
                '职场商业': '职场人士受众 + 动机反转 + 冷峻客观风格',
                '家庭伦理': '家庭成员 + 认知反转 + 深沉思辨基调',
                '青春校园': '青少年受众 + 身份反转 + 励志向上基调',
                '武侠江湖': '古代历史背景 + 双重反转 + 古典优雅风格',
                '都市奇谭': '现代都市背景 + 梦境反转 + 神秘诡异基调'
            };

            if (type && recommendations[type]) {
                recommendText.textContent = recommendations[type];
                recommendDiv.classList.remove('hidden');
            } else {
                recommendDiv.classList.add('hidden');
            }
        }

        // 难度进度条更新
        function updateDifficultyRecommend() {
            const difficulty = document.getElementById('difficulty').value;
            const progressBar = document.getElementById('difficulty-progress');

            const difficultyLevels = {
                '新手村': 14,
                '入门级': 28,
                '进阶级': 42,
                '高手级': 56,
                '大师级': 70,
                '传说级': 84,
                '地狱级': 100
            };

            const progress = difficultyLevels[difficulty] || 0;
            progressBar.style.width = progress + '%';
        }

        // 快捷键设置
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function (e) {
                // Ctrl + R: 随机生成
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    randomizeForm();
                }

                // Ctrl + Enter: 快速生成
                if (e.ctrlKey && e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('promptForm').dispatchEvent(new Event('submit'));
                }

                // Ctrl + D: 切换主题
                if (e.ctrlKey && e.key === 'd') {
                    e.preventDefault();
                    toggleTheme();
                }

                // Ctrl + /: 显示帮助
                if (e.ctrlKey && e.key === '/') {
                    e.preventDefault();
                    showShortcuts();
                }
            });
        }

        // 显示快捷键帮助
        function showShortcuts() {
            document.getElementById('shortcuts-overlay').classList.remove('hidden');
            document.getElementById('shortcuts-modal').classList.remove('hidden');
        }

        function hideShortcuts() {
            document.getElementById('shortcuts-overlay').classList.add('hidden');
            document.getElementById('shortcuts-modal').classList.add('hidden');
        }

        // 评分系统
        function rateGeneration(rating) {
            const stars = document.querySelectorAll('.rating-star');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });

            document.querySelector('.rating-score').textContent = `${rating}/5`;

            // 保存评分
            if (generationHistory.length > 0) {
                generationHistory[0].rating = rating;
                saveHistory();
                updateStatistics();
            }
        }

        // 批量生成
        function batchGenerate() {
            const batchSize = parseInt(document.getElementById('batch-size').value);
            const resultsContainer = document.getElementById('batch-results');
            resultsContainer.innerHTML = '';

            for (let i = 0; i < batchSize; i++) {
                // 随机生成参数
                randomizeForm();

                // 生成内容
                const formData = collectFormData();
                const prompt = selectedRole === 'player' ? generatePlayerPrompt(formData) : generateHostPrompt(formData);

                // 创建结果卡片
                const batchItem = document.createElement('div');
                batchItem.className = 'batch-item';
                batchItem.innerHTML = `
                    <h4>生成 #${i + 1}</h4>
                    <div class="history-tags" style="margin: 10px 0;">
                        <span class="history-tag">${formData.type}</span>
                        <span class="history-tag">${formData.difficulty}</span>
                        <span class="history-tag">${formData.setting}</span>
                    </div>
                    <div class="prompt-content" style="max-height: 300px;">
                        ${prompt}
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="copy-btn" onclick="copySpecificContent(this)">复制</button>
                        <button class="export-btn" onclick="saveAsTemplate(${i})">保存为模板</button>
                    </div>
                `;
                resultsContainer.appendChild(batchItem);
            }
        }

        // 模板系统
        function loadTemplates() {
            const templates = [
                {
                    icon: '🏚️',
                    name: '经典密室',
                    desc: '封闭空间内的推理，经典的密室杀人案设定',
                    params: {
                        type: '经典推理',
                        setting: '密室封闭',
                        twist: '身份反转',
                        difficulty: '高手级'
                    },
                    badge: '热门'
                },
                {
                    icon: '👻',
                    name: '灵异事件',
                    desc: '看似超自然的事件背后隐藏着合理的解释',
                    params: {
                        type: '恐怖惊悚',
                        setting: '豪宅别墅',
                        twist: '真假反转',
                        difficulty: '进阶级'
                    }
                },
                {
                    icon: '🕐',
                    name: '时间悖论',
                    desc: '涉及时间错位的复杂推理',
                    params: {
                        type: '科幻奇幻',
                        setting: '未来科幻',
                        twist: '时间反转',
                        difficulty: '大师级'
                    },
                    badge: '高难度'
                },
                {
                    icon: '💔',
                    name: '情感纠葛',
                    desc: '复杂的人际关系和情感动机',
                    params: {
                        type: '爱情情感',
                        setting: '现代都市',
                        twist: '动机反转',
                        difficulty: '进阶级'
                    }
                },
                {
                    icon: '🏝️',
                    name: '孤岛求生',
                    desc: '与世隔绝的环境中发生的神秘事件',
                    params: {
                        type: '经典推理',
                        setting: '海岛孤岛',
                        twist: '生死反转',
                        difficulty: '高手级'
                    }
                },
                {
                    icon: '🏛️',
                    name: '历史谜案',
                    desc: '历史背景下的推理故事',
                    params: {
                        type: '历史人文',
                        setting: '古代历史',
                        twist: '身份反转',
                        difficulty: '进阶级'
                    }
                }
            ];

            const container = document.getElementById('template-grid');
            container.innerHTML = templates.map((template, index) => `
                <div class="template-card" onclick="applyTemplate(${index})">
                    <div class="template-icon">${template.icon}</div>
                    <div class="template-name">${template.name}</div>
                    <div class="template-desc">${template.desc}</div>
                    ${template.badge ? `<div class="template-badge">${template.badge}</div>` : ''}
                </div>
            `).join('');

            // 保存模板数据供后续使用
            window.templates = templates;
        }

        function applyTemplate(index) {
            const template = window.templates[index];

            // 应用模板参数
            Object.entries(template.params).forEach(([key, value]) => {
                const element = document.getElementById(key);
                if (element) {
                    element.value = value;
                    showDescription(key);
                }
            });

            // 切换到生成器标签
            switchTab('generator');
            document.querySelector('.nav-tab').click();

            // 显示提示
            alert(`已应用"${template.name}"模板`);
        }

        // 统计图表
        function drawStatsChart() {
            const canvas = document.getElementById('stats-chart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const typeStats = statistics.typeUsage || {};

            // 简单的柱状图实现
            const data = Object.entries(typeStats).slice(0, 5);
            const maxValue = Math.max(...data.map(d => d[1]), 1);

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const barWidth = canvas.width / (data.length * 2);
            const barGap = barWidth;

            data.forEach(([type, count], index) => {
                const barHeight = (count / maxValue) * (canvas.height - 40);
                const x = index * (barWidth + barGap) + barGap;
                const y = canvas.height - barHeight - 20;

                // 绘制柱子
                ctx.fillStyle = '#667eea';
                ctx.fillRect(x, y, barWidth, barHeight);

                // 绘制标签
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(type.substring(0, 4), x + barWidth / 2, canvas.height - 5);
                ctx.fillText(count, x + barWidth / 2, y - 5);
            });
        }

        // 更新统计数据
        function updateStatistics() {
            const totalEl = document.getElementById('total-generations');
            const avgRatingEl = document.getElementById('avg-rating');
            const favTypeEl = document.getElementById('favorite-type');
            const favDiffEl = document.getElementById('favorite-difficulty');

            if (totalEl) totalEl.textContent = statistics.totalGenerations || 0;

            if (avgRatingEl) {
                const ratings = generationHistory.filter(h => h.rating).map(h => h.rating);
                const avg = ratings.length > 0 ? (ratings.reduce((a, b) => a + b, 0) / ratings.length).toFixed(1) : '0.0';
                avgRatingEl.textContent = avg;
            }

            if (favTypeEl && statistics.typeUsage) {
                const favType = Object.entries(statistics.typeUsage).sort((a, b) => b[1] - a[1])[0];
                favTypeEl.textContent = favType ? favType[0] : '-';
            }

            if (favDiffEl && statistics.difficultyUsage) {
                const favDiff = Object.entries(statistics.difficultyUsage).sort((a, b) => b[1] - a[1])[0];
                favDiffEl.textContent = favDiff ? favDiff[0] : '-';
            }
        }

        // 保存和加载功能
        function saveHistory() {
            localStorage.setItem('turtleSoupHistory', JSON.stringify(generationHistory));
            localStorage.setItem('turtleSoupStats', JSON.stringify(statistics));
        }

        function loadHistory() {
            const historyContainer = document.getElementById('history-list');
            if (!historyContainer) return;

            historyContainer.innerHTML = generationHistory.map((item, index) => `
                <div class="history-item" onclick="loadHistoryItem(${index})">
                    <div class="history-header">
                        <div>
                            <div class="history-title">${item.type} - ${item.difficulty}</div>
                            <div class="history-date">${new Date(item.timestamp).toLocaleString()}</div>
                        </div>
                        <div class="history-actions">
                            <button class="history-action-btn" onclick="event.stopPropagation(); toggleFavorite(${index})">
                                ${item.favorite ? '⭐' : '☆'}
                            </button>
                            <button class="history-action-btn" onclick="event.stopPropagation(); deleteHistoryItem(${index})">
                                🗑️
                            </button>
                        </div>
                    </div>
                    <div class="history-tags">
                        <span class="history-tag">${item.setting}</span>
                        <span class="history-tag">${item.style}</span>
                        ${item.themes.map(t => `<span class="history-tag">${t}</span>`).join('')}
                    </div>
                </div>
            `).join('') || '<p style="text-align: center; color: #999;">暂无历史记录</p>';
        }

        function loadHistoryItem(index) {
            const item = generationHistory[index];

            // 恢复所有参数
            Object.entries(item).forEach(([key, value]) => {
                const element = document.getElementById(key);
                if (element && element.tagName === 'SELECT') {
                    element.value = value;
                } else if (element && element.tagName === 'INPUT') {
                    element.value = value;
                } else if (element && element.tagName === 'TEXTAREA') {
                    element.value = value;
                }
            });

            // 恢复主题和元素选择
            if (item.themes) {
                selectedData.themes = item.themes;
                updateDisplay('themes');
            }

            if (item.elements) {
                selectedData.elements = item.elements;
                updateDisplay('elements');
            }

            // 切换到生成器
            switchTab('generator');
            document.querySelector('.nav-tab').click();
        }

        // 导出功能
        function exportAs(format) {
            const content = document.getElementById('prompt-content').textContent;
            const timestamp = new Date().toISOString().split('T')[0];

            switch (format) {
                case 'txt':
                    downloadFile(`海龟汤_${timestamp}.txt`, content, 'text/plain');
                    break;
                case 'json':
                    const jsonData = {
                        content: content,
                        parameters: collectFormData(),
                        timestamp: new Date().toISOString()
                    };
                    downloadFile(`海龟汤_${timestamp}.json`, JSON.stringify(jsonData, null, 2), 'application/json');
                    break;
            }
        }

        function downloadFile(filename, content, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // 快速操作
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function quickGenerate() {
            // 快速随机生成
            randomizeForm();
            document.getElementById('promptForm').dispatchEvent(new Event('submit'));
        }

        // 收集表单数据
        function collectFormData() {
            return {
                type: document.getElementById('type').value,
                difficulty: document.getElementById('difficulty').value,
                setting: document.getElementById('setting').value,
                characters: document.getElementById('characters').value,
                twist: document.getElementById('twist').value,
                style: document.getElementById('style').value,
                audience: document.getElementById('audience').value,
                length: document.getElementById('length').value,
                themes: selectedData.themes,
                elements: selectedData.elements,
                customElements: document.getElementById('custom-elements').value,
                emotion: document.getElementById('emotion').value,
                special: document.getElementById('special').value,
                logicLevel: document.getElementById('logic-level').value,
                creativity: document.getElementById('creativity').value,
                // 高级设置
                clueDensity: document.getElementById('clue-density')?.value,
                reasoningPath: document.getElementById('reasoning-path')?.value,
                solutionUniqueness: document.getElementById('solution-uniqueness')?.value,
                redHerring: document.getElementById('red-herring')?.value
            };
        }

        // 角色选择
        document.querySelectorAll('.role-tab').forEach(tab => {
            tab.addEventListener('click', function () {
                const role = this.dataset.role;
                selectRole(role);
            });
        });

        function selectRole(role) {
            selectedRole = role;

            // 更新视觉反馈
            document.querySelectorAll('.role-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-role="${role}"]`).classList.add('active');

            // 更新描述
            const descriptions = {
                'player': '我想要挑战海龟汤谜题，只需要汤面内容进行推理',
                'host': '我要主持海龟汤游戏，需要完整的汤面、汤底和主持人手册'
            };
            document.getElementById('role-description').textContent = descriptions[role];

            // 更新按钮文字
            const btn = document.getElementById('generateBtn');
            const btnText = document.getElementById('generate-text');
            if (role === 'player') {
                btnText.textContent = '🧩 生成汤面挑战';
            } else {
                btnText.textContent = '🎪 生成完整主持内容';
            }
        }

        // 显示参数描述
        function showDescription(selectId) {
            const select = document.getElementById(selectId);
            const descDiv = document.getElementById(selectId + '-desc');
            const value = select.value;

            if (value && descriptions[selectId] && descriptions[selectId][value]) {
                descDiv.textContent = descriptions[selectId][value].criteria;
                descDiv.classList.remove('hidden');
            } else {
                descDiv.classList.add('hidden');
            }
        }

        function updateSelection(type, checkbox) {
            const value = checkbox.value;
            const item = checkbox.closest('.checkbox-item');

            if (checkbox.checked) {
                if (!selectedData[type].includes(value)) {
                    selectedData[type].push(value);
                }
                item.classList.add('selected');
            } else {
                selectedData[type] = selectedData[type].filter(item => item !== value);
                item.classList.remove('selected');
            }

            updateDisplay(type);
        }

        function updateDisplay(type) {
            const display = document.getElementById(type + '-display');
            const items = selectedData[type];

            if (items.length === 0) {
                const placeholder = type === 'themes' ? '请选择1-3个核心主题' : '可选择0-5个情节元素';
                display.innerHTML = `<span style="color: #666;">${placeholder}</span>`;
            } else {
                const tags = items.map(item => `<span class="tag">${item}</span>`).join('');
                display.innerHTML = tags;
            }
        }

        function clearAllSelections(type) {
            selectedData[type] = [];
            document.querySelectorAll(`#${type}-group .checkbox-item`).forEach(item => {
                item.classList.remove('selected');
                item.querySelector('input[type="checkbox"]').checked = false;
            });
            updateDisplay(type);
        }

        // 随机生成功能
        function randomizeForm() {
            // 获取所有选项
            const selects = ['type', 'difficulty', 'setting', 'characters', 'twist', 'style', 'audience', 'length', 'emotion'];

            // 随机选择下拉菜单
            selects.forEach(id => {
                const select = document.getElementById(id);
                const options = Array.from(select.options).filter(opt => opt.value);
                if (options.length > 0) {
                    const randomIndex = Math.floor(Math.random() * options.length);
                    select.value = options[randomIndex].value;
                    showDescription(id);
                }
            });

            // 随机选择逻辑严密度和创意程度
            const logicSelect = document.getElementById('logic-level');
            const logicOptions = Array.from(logicSelect.options);
            logicSelect.value = logicOptions[Math.floor(Math.random() * logicOptions.length)].value;
            showDescription('logic-level');

            const creativitySelect = document.getElementById('creativity');
            const creativityOptions = Array.from(creativitySelect.options);
            creativitySelect.value = creativityOptions[Math.floor(Math.random() * creativityOptions.length)].value;
            showDescription('creativity');

            // 清空之前的选择
            clearAllSelections('themes');
            clearAllSelections('elements');

            // 随机选择1-3个主题
            const allThemes = Array.from(document.querySelectorAll('#themes-group input[type="checkbox"]'));
            const themeCount = Math.floor(Math.random() * 3) + 1; // 1-3个
            const shuffledThemes = allThemes.sort(() => Math.random() - 0.5);
            for (let i = 0; i < themeCount && i < shuffledThemes.length; i++) {
                shuffledThemes[i].checked = true;
                updateSelection('themes', shuffledThemes[i]);
            }

            // 随机选择0-5个元素
            const allElements = Array.from(document.querySelectorAll('#elements-group input[type="checkbox"]'));
            const elementCount = Math.floor(Math.random() * 6); // 0-5个
            const shuffledElements = allElements.sort(() => Math.random() - 0.5);
            for (let i = 0; i < elementCount && i < shuffledElements.length; i++) {
                shuffledElements[i].checked = true;
                updateSelection('elements', shuffledElements[i]);
            }

            // 清空自定义元素和特殊要求
            document.getElementById('custom-elements').value = '';
            document.getElementById('special').value = '';

            // 随机高级设置
            if (Math.random() > 0.5) {
                toggleAdvanced();
                ['clue-density', 'reasoning-path', 'solution-uniqueness', 'red-herring'].forEach(id => {
                    const select = document.getElementById(id);
                    if (select) {
                        const options = Array.from(select.options);
                        select.value = options[Math.floor(Math.random() * options.length)].value;
                    }
                });
            }

            // 检查兼容性
            checkCompatibility();
            updateDifficultyRecommend();

            // 添加动画效果
            const button = event.target;
            button.style.transform = 'scale(0.95)';
            setTimeout(() => {
                button.style.transform = 'scale(1)';
            }, 200);
        }

        document.getElementById('promptForm').addEventListener('submit', function (e) {
            e.preventDefault();

            if (selectedData.themes.length === 0) {
                alert('请至少选择一个核心主题');
                return;
            }

            // 显示加载状态
            const btnText = document.getElementById('generate-text');
            const loading = document.getElementById('generate-loading');
            btnText.classList.add('hidden');
            loading.classList.remove('hidden');
            document.getElementById('generateBtn').disabled = true;

            // 模拟生成过程
            setTimeout(() => {
                generateContent();

                // 恢复按钮状态
                btnText.classList.remove('hidden');
                loading.classList.add('hidden');
                document.getElementById('generateBtn').disabled = false;
            }, 100);
        });

        function generateContent() {
            const formData = collectFormData();

            // 更新统计
            statistics.totalGenerations = (statistics.totalGenerations || 0) + 1;
            statistics.typeUsage = statistics.typeUsage || {};
            statistics.typeUsage[formData.type] = (statistics.typeUsage[formData.type] || 0) + 1;
            statistics.difficultyUsage = statistics.difficultyUsage || {};
            statistics.difficultyUsage[formData.difficulty] = (statistics.difficultyUsage[formData.difficulty] || 0) + 1;

            // 保存到历史
            const historyItem = {
                ...formData,
                timestamp: new Date().toISOString(),
                role: selectedRole
            };
            generationHistory.unshift(historyItem);
            if (generationHistory.length > 100) {
                generationHistory = generationHistory.slice(0, 100);
            }

            saveHistory();
            loadHistory();
            updateStatistics();

            let prompt = '';

            if (selectedRole === 'player') {
                prompt = generatePlayerPrompt(formData);
                document.getElementById('role-badge').textContent = '玩家模式';
            } else {
                prompt = generateHostPrompt(formData);
                document.getElementById('role-badge').textContent = '主持人模式';
            }

            document.getElementById('prompt-content').textContent = prompt;
            document.getElementById('output').classList.remove('hidden');
            document.getElementById('output').scrollIntoView({ behavior: 'smooth' });

            // 重置评分
            document.querySelectorAll('.rating-star').forEach(star => star.classList.remove('active'));
            document.querySelector('.rating-score').textContent = '未评分';
        }

        function getDifficultyDescription(difficulty) {
            const difficultyData = descriptions.difficulty[difficulty];
            return difficultyData ? difficultyData.display : '适中';
        }

        function getDifficultyFullDescription(difficulty) {
            const difficultyData = descriptions.difficulty[difficulty];
            return difficultyData ? difficultyData.criteria : '';
        }

        function getLogicDescription(level) {
            const logicData = descriptions['logic-level'] && descriptions['logic-level'][level];
            return logicData ? logicData.display : '标准';
        }

        function getCreativityDescription(level) {
            const creativityData = descriptions.creativity && descriptions.creativity[level];
            return creativityData ? creativityData.display : '平衡创新';
        }

        function generatePlayerPrompt(data) {
            const explainParams = document.getElementById('explainParams').checked;
            const allElements = [...data.elements, ...(data.customElements ? data.customElements.split(',').map(s => s.trim()) : [])];

            let prompt = `请创作一个海龟汤谜题的汤面。海龟汤是一种情境推理游戏，玩家需要通过提问来揭开背后的真相。
核心要求：
- 谜题必须有内在逻辑连贯性，每个细节都有其存在的必然性
- 真相揭晓时要让人感到"原来如此"而非"牵强附会"
- 避免依赖巧合、文字游戏或低概率事件
- 确保因果链条清晰且符合现实逻辑
- 避免出现"空灵"或"空虚"的谜题
- 确保玩家能通过各种方式来理解并解释谜题的真相


创作要求：
- 类型：${data.type}
- 难度：${data.difficulty}
- 背景：${data.setting}
- 人物：${data.characters}
- 反转：${data.twist}
- 风格：${data.style}
- 受众：${data.audience}
- 长度：${data.length}（${getLengthRange(data.length)}）
- 主题：${data.themes.join('、')}
- 逻辑严密度：${getLogicDescription(data.logicLevel)}
- 创意程度：${getCreativityDescription(data.creativity)}`;

            // 添加高级设置
            if (data.clueDensity) {
                prompt += `
- 线索密度：${descriptions['clue-density'][data.clueDensity].display}`;
            }
            if (data.reasoningPath) {
                prompt += `
- 推理路径：${descriptions['reasoning-path'][data.reasoningPath].display}`;
            }
            if (data.solutionUniqueness) {
                prompt += `
- 答案唯一性：${descriptions['solution-uniqueness'][data.solutionUniqueness].display}`;
            }
            if (data.redHerring) {
                prompt += `
- 误导强度：${descriptions['red-herring'][data.redHerring].display}`;
            }

            if (allElements.length > 0) {
                prompt += `
- 关键元素：${allElements.join('、')}`;
            }

            if (data.emotion) {
                prompt += `
- 情感基调：${data.emotion}`;
            }

            if (data.special) {
                prompt += `
- 特殊要求：${data.special}`;
            }

            // 如果选择解释参数，则添加详细说明
            if (explainParams) {
                prompt += `

参数说明：`;

                if (descriptions.type[data.type]) {
                    prompt += `
- ${data.type}：${descriptions.type[data.type].criteria}`;
                }

                if (descriptions.difficulty[data.difficulty]) {
                    prompt += `
- ${data.difficulty}：${descriptions.difficulty[data.difficulty].criteria}`;
                }

                if (descriptions.setting[data.setting]) {
                    prompt += `
- ${data.setting}：${descriptions.setting[data.setting].criteria}`;
                }

                if (descriptions.characters[data.characters]) {
                    prompt += `
- ${data.characters}：${descriptions.characters[data.characters].criteria}`;
                }

                if (descriptions.twist[data.twist]) {
                    prompt += `
- ${data.twist}：${descriptions.twist[data.twist].criteria}`;
                }

                if (descriptions.style[data.style]) {
                    prompt += `
- ${data.style}：${descriptions.style[data.style].criteria}`;
                }

                if (descriptions['logic-level'] && descriptions['logic-level'][data.logicLevel]) {
                    prompt += `
- ${getLogicDescription(data.logicLevel)}：${descriptions['logic-level'][data.logicLevel].criteria}`;
                }

                if (descriptions.creativity && descriptions.creativity[data.creativity]) {
                    prompt += `
- ${getCreativityDescription(data.creativity)}：${descriptions.creativity[data.creativity].criteria}`;
                }

                if (data.emotion && descriptions.emotion && descriptions.emotion[data.emotion]) {
                    prompt += `
- ${data.emotion}：${descriptions.emotion[data.emotion].criteria}`;
                }

                // 高级设置说明
                if (data.clueDensity && descriptions['clue-density'] && descriptions['clue-density'][data.clueDensity]) {
                    prompt += `
- 线索密度：${descriptions['clue-density'][data.clueDensity].criteria}`;
                }
                if (data.reasoningPath && descriptions['reasoning-path'] && descriptions['reasoning-path'][data.reasoningPath]) {
                    prompt += `
- 推理路径：${descriptions['reasoning-path'][data.reasoningPath].criteria}`;
                }
                if (data.solutionUniqueness && descriptions['solution-uniqueness'] && descriptions['solution-uniqueness'][data.solutionUniqueness]) {
                    prompt += `
- 答案唯一性：${descriptions['solution-uniqueness'][data.solutionUniqueness].criteria}`;
                }
                if (data.redHerring && descriptions['red-herring'] && descriptions['red-herring'][data.redHerring]) {
                    prompt += `
- 误导强度：${descriptions['red-herring'][data.redHerring].criteria}`;
                }
            }

            prompt += `

创作标准：
- 汤面必须呈现一个看似矛盾或不合理的情境
- 每个细节都要经得起逻辑推敲，不能有漏洞
- 描述要生动具体，能引发强烈的好奇心
- 结尾要留有悬念，让人想要探究真相
- 符合目标受众的理解能力和价值观
- 关键信息的隐藏要巧妙而非刻意
- 每个词语都经过推敲，既不误导也不泄露


请直接输出汤面内容，不要包含任何解释或说明。`;

            return prompt;
        }

        function generateHostPrompt(data) {
            const explainParams = document.getElementById('explainParams').checked;
            const allElements = [...data.elements, ...(data.customElements ? data.customElements.split(',').map(s => s.trim()) : [])];

            let prompt = `请为海龟汤游戏创作一套完整的主持材料。
核心要求：
- 谜题必须有内在逻辑连贯性，每个细节都有其存在的必然性
- 真相揭晓时要让人感到"原来如此"而非"牵强附会"
- 避免依赖巧合、文字游戏或低概率事件
- 确保因果链条清晰且符合现实逻辑
- 避免出现"空灵"或"空虚"的谜题
- 确保玩家能通过各种方式来理解并解释谜题的真相

创作要求：
- 类型：${data.type}
- 难度：${data.difficulty}
- 背景：${data.setting}
- 人物：${data.characters}
- 反转：${data.twist}
- 风格：${data.style}
- 受众：${data.audience}
- 长度：${data.length}（${getLengthRange(data.length)}）
- 主题：${data.themes.join('、')}
- 逻辑严密度：${getLogicDescription(data.logicLevel)}
- 创意程度：${getCreativityDescription(data.creativity)}`;

            // 添加高级设置
            if (data.clueDensity) {
                prompt += `
- 线索密度：${descriptions['clue-density'][data.clueDensity].display}`;
            }
            if (data.reasoningPath) {
                prompt += `
- 推理路径：${descriptions['reasoning-path'][data.reasoningPath].display}`;
            }
            if (data.solutionUniqueness) {
                prompt += `
- 答案唯一性：${descriptions['solution-uniqueness'][data.solutionUniqueness].display}`;
            }
            if (data.redHerring) {
                prompt += `
- 误导强度：${descriptions['red-herring'][data.redHerring].display}`;
            }

            if (allElements.length > 0) {
                prompt += `
- 关键元素：${allElements.join('、')}`;
            }

            if (data.emotion) {
                prompt += `
- 情感基调：${data.emotion}`;
            }

            if (data.special) {
                prompt += `
- 特殊要求：${data.special}`;
            }

            // 如果选择解释参数，则添加详细说明
            if (explainParams) {
                prompt += `

参数说明：`;

                // 同样添加所有参数的详细说明（与generatePlayerPrompt相同的格式）
                // 省略重复代码，但实际使用时需要包含完整的参数说明
            }

            prompt += `

请按以下结构输出：

【汤面】
[一个看似矛盾的情境描述]

【汤底】
背景故事：[详细的事件背景和人物关系]
事件经过：[按时间顺序的完整事件描述]
真相揭秘：[解释所有矛盾和疑点的核心真相]
逻辑验证：[确认所有细节的合理性]

【主持指南】
开场建议：
- 游戏规则说明
- 氛围营造技巧

问答策略：
- 关键信息的回答原则
- 误导信息的处理方式
- 线索释放的节奏控制

常见问题：
- [列出5-10个玩家可能提出的关键问题及标准答案]

创作标准：
- 汤面必须呈现一个看似矛盾或不合理的情境
- 每个细节都要经得起逻辑推敲，不能有漏洞
- 描述要生动具体，能引发强烈的好奇心
- 结尾要留有悬念，让人想要探究真相
- 符合目标受众的理解能力和价值观

注意事项：
- 避免过早暴露核心信息
- 保持逻辑一致性
- 根据玩家进度调整难度`;

            return prompt;
        }

        function getLengthRange(length) {
            const ranges = {
                '微型': '50-100字',
                '短篇': '100-300字',
                '中篇': '300-600字',
                '长篇': '600-1000字',
                '史诗': '1000字以上'
            };
            return ranges[length] || '适当篇幅';
        }

        function copyContent() {
            const content = document.getElementById('prompt-content').textContent;

            navigator.clipboard.writeText(content).then(function () {
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = '✅ 已复制';
                button.style.background = '#007bff';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '#28a745';
                }, 2000);
            }, function () {
                alert('复制失败，请手动复制');
            });
        }

        // 复制特定内容（批量生成用）
        function copySpecificContent(button) {
            const content = button.parentElement.previousElementSibling.textContent;

            navigator.clipboard.writeText(content).then(function () {
                const originalText = button.textContent;
                button.textContent = '✅ 已复制';
                button.style.background = '#007bff';
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '#6c757d';
                }, 2000);
            });
        }

        // 保存为模板
        function saveAsTemplate(index) {
            const customTemplates = JSON.parse(localStorage.getItem('customTemplates') || '[]');
            const formData = collectFormData();

            const templateName = prompt('请输入模板名称：');
            if (!templateName) return;

            const newTemplate = {
                icon: '⭐',
                name: templateName,
                desc: `${formData.type} - ${formData.difficulty}`,
                params: formData,
                badge: '自定义',
                custom: true,
                timestamp: new Date().toISOString()
            };

            customTemplates.push(newTemplate);
            localStorage.setItem('customTemplates', JSON.stringify(customTemplates));

            alert(`"${templateName}"已保存到模板库`);
            loadTemplates();
        }

        // 删除历史记录项
        function deleteHistoryItem(index) {
            if (confirm('确定要删除这条历史记录吗？')) {
                generationHistory.splice(index, 1);
                saveHistory();
                loadHistory();
            }
        }

        // 切换收藏状态
        function toggleFavorite(index) {
            generationHistory[index].favorite = !generationHistory[index].favorite;
            saveHistory();
            loadHistory();
        }

        // 导出历史记录
        function exportHistory() {
            const data = {
                history: generationHistory,
                statistics: statistics,
                exportDate: new Date().toISOString()
            };

            downloadFile(
                `海龟汤历史记录_${new Date().toISOString().split('T')[0]}.json`,
                JSON.stringify(data, null, 2),
                'application/json'
            );
        }

        // 清空历史记录
        function clearHistory() {
            if (confirm('确定要清空所有历史记录吗？此操作不可恢复！')) {
                generationHistory = [];
                statistics = {};
                saveHistory();
                loadHistory();
                updateStatistics();
                alert('历史记录已全部清空');
            }
        }

        // 加载用户偏好
        function loadUserPreferences() {
            const preferences = JSON.parse(localStorage.getItem('userPreferences') || '{}');

            // 恢复上次的参数设置
            if (preferences.lastParams) {
                Object.entries(preferences.lastParams).forEach(([key, value]) => {
                    const element = document.getElementById(key);
                    if (element && element.tagName === 'SELECT') {
                        element.value = value;
                    }
                });
            }
        }

        // 保存用户偏好
        function saveUserPreferences() {
            const preferences = {
                lastParams: collectFormData(),
                timestamp: new Date().toISOString()
            };

            localStorage.setItem('userPreferences', JSON.stringify(preferences));
        }
    </script>
</body>

</html>
