<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰‹åŠ¨ç”µæŠ¥å‘é€å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            min-height: 100vh;
            padding: 10px;
            color: #fff;
            user-select: none;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #ffeb3b;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 10px;
        }

        .instructions {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            color: #fff3cd;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .telegraph-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #4caf50;
        }

        .morse-reference {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #ff9800;
            display: none;
        }

        .morse-reference.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #ffeb3b;
            text-align: center;
        }

        .telegraph-key {
            width: 150px;
            height: 150px;
            background: linear-gradient(145deg, #2c2c2c, #1a1a1a);
            border: 4px solid #666;
            border-radius: 50%;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.1s ease;
            position: relative;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
        }

        .telegraph-key:active, .telegraph-key.pressed {
            background: linear-gradient(145deg, #4caf50, #45a049);
            border-color: #4caf50;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4);
            transform: translateY(2px);
        }

        .key-label {
            color: #fff;
            font-size: 1.2em;
            font-weight: bold;
            text-align: center;
        }

        .timing-display {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            border: 1px solid #333;
        }

        .timing-bar {
            height: 20px;
            background: #333;
            border-radius: 10px;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
        }

        .timing-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            border-radius: 10px;
            width: 0%;
            transition: width 0.1s ease;
        }

        .morse-display {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            padding: 20px;
            min-height: 100px;
            border: 2px solid #333;
            margin: 20px 0;
            font-size: 1.5em;
        }

        .morse-current {
            color: #ffeb3b;
            font-size: 2em;
            text-align: center;
            margin-bottom: 15px;
            min-height: 40px;
        }

        .morse-history {
            color: #4caf50;
            font-size: 1.2em;
            word-break: break-all;
            line-height: 1.6;
        }

        .decoded-text {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            color: #e8f5e8;
            font-size: 1.1em;
            min-height: 60px;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        button {
            flex: 1;
            min-width: 100px;
            padding: 12px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Courier New', monospace;
        }

        .clear-btn {
            background: #f44336;
            color: white;
        }

        .clear-btn:hover {
            background: #da190b;
            transform: translateY(-2px);
        }

        .space-btn {
            background: #2196f3;
            color: white;
        }

        .space-btn:hover {
            background: #1976d2;
            transform: translateY(-2px);
        }

        .backspace-btn {
            background: #ff9800;
            color: white;
        }

        .morse-toggle-btn {
            background: #ff9800;
            color: white;
        }

        .morse-toggle-btn:hover {
            background: #f57c00;
            transform: translateY(-2px);
        }

        .morse-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 8px;
            max-height: 400px;
            overflow-y: auto;
        }

        .morse-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px;
            border-radius: 5px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .morse-item.highlight {
            background: rgba(255, 235, 59, 0.3);
            border-color: #ffeb3b;
            transform: scale(1.05);
        }

        .morse-char {
            font-size: 1.1em;
            font-weight: bold;
            color: #ffeb3b;
        }

        .morse-code {
            font-size: 1em;
            color: #4caf50;
            margin-top: 3px;
        }

        .stats {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            text-align: center;
        }

        .stat-item {
            display: inline-block;
            margin: 0 15px;
            padding: 5px 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
        }

        .audio-feedback {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: rgba(76, 175, 80, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: 1000;
        }

        .audio-feedback.active {
            opacity: 1;
        }

        @media (max-width: 767px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .telegraph-key {
                width: 120px;
                height: 120px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            button {
                min-width: 100%;
            }
            
            .morse-grid {
                grid-template-columns: repeat(3, 1fr);
                max-height: 250px;
            }

            .stat-item {
                display: block;
                margin: 5px 0;
            }
        }

        .pulse {
            animation: pulse 0.3s ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âš¡ æ‰‹åŠ¨ç”µæŠ¥å‘é€å™¨</h1>
            <div class="instructions">
                ğŸ“‹ <strong>æ“ä½œè¯´æ˜ï¼š</strong><br>
                â€¢ æŒ‰ä½ç”µæŠ¥é”®å‘é€ä¿¡å·ï¼ˆçŸ­æŒ‰=ç‚¹ï¼Œé•¿æŒ‰=åˆ’ï¼‰<br>
                â€¢ ç‚¹å‡»"ç©ºæ ¼"åˆ†éš”å­—æ¯ï¼Œè¿ç»­ç©ºæ ¼åˆ†éš”å•è¯<br>
                â€¢ æ”¯æŒé¼ æ ‡ã€è§¦æ‘¸å’Œé”®ç›˜æ“ä½œï¼ˆç©ºæ ¼é”®ï¼‰
            </div>
        </div>

        <div class="main-content">
            <div class="telegraph-panel">
                <h2 class="section-title">ğŸ“¡ ç”µæŠ¥å‘é€å°</h2>
                
                <div class="morse-display">
                    <div class="morse-current" id="currentMorse">ç­‰å¾…è¾“å…¥...</div>
                    <div class="morse-history" id="morseHistory"></div>
                </div>

                <div class="decoded-text" id="decodedText">
                    è§£ç æ–‡æœ¬å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...
                </div>

                <div class="controls">
                    <button class="space-btn" onclick="addSpace()">ç©ºæ ¼åˆ†éš”</button>
                    <button class="backspace-btn" onclick="backspace()">åˆ é™¤</button>
                    <button class="clear-btn" onclick="clearAll()">å…¨éƒ¨æ¸…ç©º</button>
                    <button class="morse-toggle-btn" onclick="toggleMorseTable()">ğŸ“Š æ˜¾ç¤ºç”µç è¡¨</button>
                </div>

                <div class="telegraph-key" id="telegraphKey">
                    <div class="key-label">ç”µæŠ¥é”®<br>PRESS</div>
                </div>

                <div class="timing-display">
                    <div>æŒ‰é”®æ—¶é•¿æ§åˆ¶</div>
                    <div class="timing-bar">
                        <div class="timing-fill" id="timingFill"></div>
                    </div>
                    <div id="timingText">å‡†å¤‡å‘é€...</div>
                </div>

                <div class="stats">
                    <div class="stat-item">å‘é€å­—ç¬¦: <span id="charCount">0</span></div>
                    <div class="stat-item">æ‘©å°”æ–¯ç : <span id="morseCount">0</span></div>
                    <div class="stat-item">é€Ÿåº¦: <span id="wpm">0</span> WPM</div>
                </div>
            </div>

            <div class="morse-reference" id="morseReference">
                <h2 class="section-title">ğŸ“Š æ‘©å°”æ–¯ç”µç è¡¨</h2>
                <div class="morse-grid" id="morseGrid">
                    <!-- æ‘©å°”æ–¯ç å¯¹ç…§è¡¨å°†é€šè¿‡JSç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <div class="audio-feedback" id="audioFeedback">ğŸ”Š</div>

    <script>
        // æ‘©å°”æ–¯ç”µç å¯¹ç…§è¡¨
        const morseCode = {
            '.-': 'A',    '-...': 'B',  '-.-.': 'C',  '-..': 'D',   '.': 'E',
            '..-.': 'F',  '--.': 'G',   '....': 'H',  '..': 'I',    '.---': 'J',
            '-.-': 'K',   '.-..': 'L',  '--': 'M',    '-.': 'N',    '---': 'O',
            '.--.': 'P',  '--.-': 'Q',  '.-.': 'R',   '...': 'S',   '-': 'T',
            '..-': 'U',   '...-': 'V',  '.--': 'W',   '-..-': 'X',  '-.--': 'Y',
            '--..': 'Z',  '.----': '1', '..---': '2', '...--': '3', '....-': '4',
            '.....': '5', '-....': '6', '--...': '7', '---..': '8', '----.': '9',
            '-----': '0', '.-.-.-': '.', '--..--': ',', '..--..': '?', '.----.': "'",
            '-.-.--': '!', '-..-.': '/', '-.--.': '(', '-.--.-': ')', '.-...': '&',
            '---...': ':', '-.-.-.': ';', '-...-': '=', '.-.-.': '+', '-....-': '-',
            '..--.-': '_', '.-..-.': '"', '...-..-': '$', '.--.-.': '@'
        };

        // åå‘æ˜ å°„ç”¨äºå¯¹ç…§è¡¨æ˜¾ç¤º
        const codeToMorse = {};
        for (const [morse, char] of Object.entries(morseCode)) {
            codeToMorse[char] = morse;
        }

        // å…¨å±€å˜é‡
        let isPressed = false;
        let pressStartTime = 0;
        let currentMorseChar = '';
        let morseHistory = '';
        let decodedText = '';
        let pressCount = 0;
        let startTime = Date.now();
        let audioContext = null;

        // åˆå§‹åŒ–éŸ³é¢‘ä¸Šä¸‹æ–‡
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        // æ’­æ”¾éŸ³é¢‘åé¦ˆ
        function playTone(frequency = 800, duration = 0.1) {
            if (!audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);

            // æ˜¾ç¤ºéŸ³é¢‘åé¦ˆ
            const feedback = document.getElementById('audioFeedback');
            feedback.classList.add('active');
            setTimeout(() => feedback.classList.remove('active'), duration * 1000);
        }

        // ç”Ÿæˆæ‘©å°”æ–¯ç å¯¹ç…§è¡¨
        function generateMorseTable() {
            const grid = document.getElementById('morseGrid');
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789.,?\'!/()&:;=+-_"$@';
            
            for (const char of chars) {
                if (codeToMorse[char]) {
                    const item = document.createElement('div');
                    item.className = 'morse-item';
                    item.id = `morse-${char}`;
                    item.innerHTML = `
                        <div class="morse-char">${char}</div>
                        <div class="morse-code">${codeToMorse[char]}</div>
                    `;
                    grid.appendChild(item);
                }
            }
        }

        // é«˜äº®å¯¹ç…§è¡¨ä¸­çš„å­—ç¬¦
        function highlightMorseChar(char) {
            // æ¸…é™¤ä¹‹å‰çš„é«˜äº®
            document.querySelectorAll('.morse-item').forEach(item => {
                item.classList.remove('highlight');
            });
            
            // é«˜äº®å½“å‰å­—ç¬¦
            if (char && char !== ' ') {
                const item = document.getElementById(`morse-${char}`);
                if (item) {
                    item.classList.add('highlight');
                    item.classList.add('pulse');
                    setTimeout(() => item.classList.remove('pulse'), 300);
                }
            }
        }

        // å¼€å§‹æŒ‰é”®
        function startPress() {
            if (isPressed) return;
            
            initAudio();
            isPressed = true;
            pressStartTime = Date.now();
            
            const key = document.getElementById('telegraphKey');
            const timingFill = document.getElementById('timingFill');
            const timingText = document.getElementById('timingText');
            
            key.classList.add('pressed');
            timingText.textContent = 'å‘é€ä¸­...';
            
            // å¼€å§‹æ’­æ”¾éŸ³é¢‘
            playTone(800, 2); // é•¿éŸ³é¢‘ï¼Œä¼šåœ¨é‡Šæ”¾æ—¶åœæ­¢
            
            // æ—¶é•¿æ¡åŠ¨ç”»
            const interval = setInterval(() => {
                if (!isPressed) {
                    clearInterval(interval);
                    return;
                }
                
                const duration = Date.now() - pressStartTime;
                const percentage = Math.min(duration / 500, 1) * 100; // 500msä¸ºé•¿ä¿¡å·é˜ˆå€¼
                timingFill.style.width = percentage + '%';
                
                if (duration < 200) {
                    timingFill.style.background = 'linear-gradient(90deg, #4caf50, #8bc34a)';
                    timingText.textContent = 'å‘é€ä¸­... (çŸ­ä¿¡å·)';
                } else {
                    timingFill.style.background = 'linear-gradient(90deg, #ff9800, #f57c00)';
                    timingText.textContent = 'å‘é€ä¸­... (é•¿ä¿¡å·)';
                }
            }, 10);
        }

        // ç»“æŸæŒ‰é”®
        function endPress() {
            if (!isPressed) return;
            
            isPressed = false;
            const duration = Date.now() - pressStartTime;
            
            const key = document.getElementById('telegraphKey');
            const timingFill = document.getElementById('timingFill');
            const timingText = document.getElementById('timingText');
            
            key.classList.remove('pressed');
            
            // åˆ¤æ–­ç‚¹åˆ’
            let signal;
            if (duration < 200) {
                signal = '.';
                timingText.textContent = `çŸ­ä¿¡å· (${duration}ms)`;
                playTone(600, 0.1);
            } else {
                signal = '-';
                timingText.textContent = `é•¿ä¿¡å· (${duration}ms)`;
                playTone(400, 0.3);
            }
            
            // æ·»åŠ åˆ°å½“å‰å­—ç¬¦
            currentMorseChar += signal;
            updateDisplay();
            
            // é‡ç½®æ—¶é•¿æ¡
            setTimeout(() => {
                timingFill.style.width = '0%';
                timingText.textContent = 'å‡†å¤‡å‘é€...';
            }, 1000);
            
            pressCount++;
            updateStats();
        }

        // æ·»åŠ ç©ºæ ¼ï¼ˆå­—ç¬¦åˆ†éš”ï¼‰
        function addSpace() {
            if (currentMorseChar) {
                // è§£ç å½“å‰å­—ç¬¦
                const char = morseCode[currentMorseChar] || '?';
                decodedText += char;
                morseHistory += currentMorseChar + ' ';
                highlightMorseChar(char);
                
                currentMorseChar = '';
                updateDisplay();
            } else if (decodedText && !decodedText.endsWith(' ')) {
                // æ·»åŠ å•è¯åˆ†éš”ç©ºæ ¼
                decodedText += ' ';
                morseHistory += '/ ';
                updateDisplay();
            }
            updateStats();
        }

        // åˆ é™¤æ“ä½œ
        function backspace() {
            if (currentMorseChar) {
                // åˆ é™¤å½“å‰å­—ç¬¦çš„æœ€åä¸€ä¸ªä¿¡å·
                currentMorseChar = currentMorseChar.slice(0, -1);
            } else if (decodedText) {
                // åˆ é™¤å·²è§£ç æ–‡æœ¬çš„æœ€åä¸€ä¸ªå­—ç¬¦
                decodedText = decodedText.slice(0, -1);
                // åŒæ—¶åˆ é™¤å¯¹åº”çš„æ‘©å°”æ–¯ç 
                const parts = morseHistory.trim().split(' ');
                parts.pop();
                morseHistory = parts.join(' ') + (parts.length > 0 ? ' ' : '');
            }
            updateDisplay();
            updateStats();
        }

        // æ¸…ç©ºæ‰€æœ‰å†…å®¹
        function clearAll() {
            currentMorseChar = '';
            morseHistory = '';
            decodedText = '';
            pressCount = 0;
            startTime = Date.now();
            updateDisplay();
            updateStats();
            
            // æ¸…é™¤é«˜äº®
            document.querySelectorAll('.morse-item').forEach(item => {
                item.classList.remove('highlight');
            });
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            document.getElementById('currentMorse').textContent = 
                currentMorseChar || 'ç­‰å¾…è¾“å…¥...';
            document.getElementById('morseHistory').textContent = morseHistory;
            document.getElementById('decodedText').textContent = 
                decodedText || 'è§£ç æ–‡æœ¬å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...';
        }

        // åˆ‡æ¢æ‘©å°”æ–¯ç è¡¨æ˜¾ç¤º
        function toggleMorseTable() {
            const morseRef = document.getElementById('morseReference');
            const toggleBtn = document.querySelector('.morse-toggle-btn');
            
            if (morseRef.classList.contains('show')) {
                morseRef.classList.remove('show');
                toggleBtn.textContent = 'ğŸ“Š æ˜¾ç¤ºç”µç è¡¨';
            } else {
                morseRef.classList.add('show');
                toggleBtn.textContent = 'âŒ éšè—ç”µç è¡¨';
            }
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const charCount = decodedText.replace(/\s/g, '').length;
            const morseCount = morseHistory.split(' ').filter(x => x && x !== '/').length;
            const timeMinutes = (Date.now() - startTime) / 60000;
            const wpm = timeMinutes > 0 ? Math.round(charCount / 5 / timeMinutes) : 0;
            
            document.getElementById('charCount').textContent = charCount;
            document.getElementById('morseCount').textContent = morseCount;
            document.getElementById('wpm').textContent = wpm;
        }

        // äº‹ä»¶ç›‘å¬å™¨
        document.addEventListener('DOMContentLoaded', () => {
            generateMorseTable();
            
            const key = document.getElementById('telegraphKey');
            
            // é¼ æ ‡äº‹ä»¶
            key.addEventListener('mousedown', startPress);
            key.addEventListener('mouseup', endPress);
            key.addEventListener('mouseleave', endPress);
            
            // è§¦æ‘¸äº‹ä»¶
            key.addEventListener('touchstart', (e) => {
                e.preventDefault();
                startPress();
            });
            key.addEventListener('touchend', (e) => {
                e.preventDefault();
                endPress();
            });
            
            // é”®ç›˜äº‹ä»¶
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space' && !isPressed) {
                    e.preventDefault();
                    startPress();
                }
            });
            
            document.addEventListener('keyup', (e) => {
                if (e.code === 'Space' && isPressed) {
                    e.preventDefault();
                    endPress();
                }
            });
            
            // é˜²æ­¢å³é”®èœå•
            key.addEventListener('contextmenu', (e) => e.preventDefault());
        });

        // è‡ªåŠ¨åˆ†éš”å­—ç¬¦ï¼ˆå¦‚æœç”¨æˆ·åœé¡¿è¾ƒé•¿æ—¶é—´ï¼‰
        let autoSpaceTimer = null;
        function resetAutoSpaceTimer() {
            if (autoSpaceTimer) {
                clearTimeout(autoSpaceTimer);
            }
            if (currentMorseChar) {
                autoSpaceTimer = setTimeout(() => {
                    addSpace();
                }, 3000); // 3ç§’è‡ªåŠ¨åˆ†éš”
            }
        }

        // ä¿®æ”¹endPresså‡½æ•°ä»¥åŒ…å«è‡ªåŠ¨åˆ†éš”
        const originalEndPress = endPress;
        endPress = function() {
            originalEndPress.call(this);
            resetAutoSpaceTimer();
        };
    </script>
</body>
</html>